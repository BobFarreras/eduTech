ESTRUCTURA DEL PROJECTE (./src)

‚îú‚îÄ‚îÄ .env.local
‚îú‚îÄ‚îÄ .env.test
‚îú‚îÄ‚îÄ .git
‚îÇ   ‚îú‚îÄ‚îÄ COMMITMESSAGE
‚îÇ   ‚îú‚îÄ‚îÄ COMMIT_EDITMSG
‚îÇ   ‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ description
‚îÇ   ‚îú‚îÄ‚îÄ FETCH_HEAD
‚îÇ   ‚îú‚îÄ‚îÄ fork-settings
‚îÇ   ‚îú‚îÄ‚îÄ HEAD
‚îÇ   ‚îú‚îÄ‚îÄ hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ applypatch-msg.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commit-msg.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fsmonitor-watchman.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post-update.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-applypatch.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-commit.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-merge-commit.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-push.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-rebase.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-receive.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prepare-commit-msg.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ push-to-checkout.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sendemail-validate.sample
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update.sample
‚îÇ   ‚îú‚îÄ‚îÄ index
‚îÇ   ‚îú‚îÄ‚îÄ info
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exclude
‚îÇ   ‚îú‚îÄ‚îÄ logs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HEAD
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ refs
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ heads
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ develop
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ feature
‚îÇ   ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ disseny
‚îÇ   ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guia-landing-dashbaord-temas
‚îÇ   ‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ intro
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ release
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ remotes
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ origin
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ develop
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ feature
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ disseny
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ guia-landing-dashbaord-temas
‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ intro
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ HEAD
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ main
‚îÇ   ‚îú‚îÄ‚îÄ objects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 4145cddf3f9db91b57b9cb596683c8eb420862
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 0eef23e3ed3e7876206ffad64bf4494c6ef227
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7b19c3168ca82e0a98846f809ef8081b8faf12
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d74d7a73523ae654ee7996075a9c19d3272621
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d79e55310cd450d29bb498d87752859a8b9df0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 04
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0b8f194987501ed51710f784f9755cc5e7cb75
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 636a1498fd827392f5f0865a26ba2dabe92c2d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b967fbfcdfb1eea0c0a650e157cb6a0bbf5eef
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 05
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6fb6fc9c03efba3460d94879c1706390cde238
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 70397c440de7a8f3235d04daff14aa20d375ef
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e726d1b4201bc8c7716d2b058279676582e8c0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 07
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f479fe404dfe2d68e7173384701197c0b176a6
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 08
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 18b631e0b42052ced52fdff1485d28d61cc57c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ccaed9a63a41f56e6093a60168c20d00361d5c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f86f50b63dfd3dbe7d9c6c2541c177f010ef88
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0a
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b593262f0c4e6c7413096389842c7bd5cb2ddf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d69f6e23d4ad3740241f397554e8bac8744487
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 1f99ab34c339c2ea2d1a435a356118b4ff274b
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0d
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 61fc3145757dff109ec9f6e6881e8274b6fbcd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b39bab6cdcaac3727db5c9917123f8b34797b9
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ca57ff408f6ff3f3f9dd3e8438514a1d9175ad
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0e
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 4d12127f3e7b2e2d8f83ce171ab9b5a8472dc0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 10
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 574cf7398601760c6979b2d86e6ab3e6bae418
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 61a3ae36856f48e9098c4043ab0525f502a3b2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9299c2486a080e055f57352eddca7902041411
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ce8354c2e9a574f67e7ced1f1236a5d83c5c00
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 11
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1a4703e992d2e086f64b5b44e7699e1a66ee37
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 3ff51874a0c194cabf16238facf1606639b430
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 13
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 37c09f5b5c6afbc222872e76b15f45ce8afde4
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fd6ef1df7a3a04a7b9ac2109d583a577a01c41
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 14
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0a2428b176921e71677d0ae9fe72c2471e62f0
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 239e33c642ebae81dfead9793f6d448c4c3d53
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e6698b9cd6ef72606c4c8e46e26459b14c0c28
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 16
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0d71f1d1997fdcb81238ed50462a2a9585220f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1a5baa5cc7fa8cebd87f46159a43da7988b632
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c346783d7e4de061a989a4660454ec563981a8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c8cd51d4ee5f89b5282289da25958bcd7aa87a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fb5feeaaef791cdae952849d2745fefb17c61c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fe115375f775a90f6949733f3b23725f7b9ea3
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 17
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 975f58393f8de813a56bdd14fa617c738918b2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b05bf1e17c6d2338f255fdc91766a0d266a9d7
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 19
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a064bcb06e714c0b9d82e9c88af2e379ffd506
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c3c9199df07fd38b5f14bb1a613ac88710994c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f1cd7c5a82bd4185760e4cb037bf65550ef2fb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1b
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 38c4140d843dd5048c7fc01778190a278d5f4f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bdefa03f86d5362e42a17484cb981f35cf9657
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 0a646399d463b41f6fb0d7c4b61fc91a88fbb6
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1e
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 9299edcaaf0d95b04beba9a1fd734ad9efd61c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 1b0d2c58bca49764a3308a108951e0452c5638
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 04c8a4c68447324ad5c34657703fce95ffd976
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 21
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 15cf378d7577f78415d621838b573f98aaa2e8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4acebfb2e59637b8974f757bd321cb72d1e7df
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ de2a25ecb0133617c8662b35c9665af8671e59
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ead2c8bae08f5d4ca086cf368710e69c45327c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 22
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3a5c1d5702bf142f9bb8557b4bb0c831ffca78
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4d0bf38eca17c182142d9a2de8b87a3de1fabd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c16c118afe1205caa5fc80806e2dc3596997f1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 24
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aff6fb486ebedb9637e2053d08186a5c9e61cc
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 25
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 620be82adf68408563df8406776739ece50cba
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 9cb818bbe158d8652b209a09ba3793c7d85164
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 26
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c1ad9bb3f31571028cc2e70efd84b4bc521f94
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 28
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3755f6a4baa82f78345123acb23ceea1e38b8c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d949ca0826d217ff324d737ff58ed654d667c9
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ df353e961d46630a57d7a8ea7b6a6f54f7bd88
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 29
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5f8fdf14fcfe6cccaa832133037157521b1890
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b31ab112cf6500423b77898317dd139f59d5b3
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bf102ba89b603bf873441d557f7580fbd941a6
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ed011bba0f49f19aa1b2f970c6849754cf69eb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b180444840fd8115b4d7ad05ab2d3bb3e00410
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 33dae76f776268f9eacf7f9bed0eb7afb79897
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a3e961a71678c49e89eb2bb8e1c17c4f367b6c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d7983b1c3542b0765ea7bc182d7b1b8d1a8f37
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 72dafbb02d7daf4a151c7c14ee763b190fe60e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 30
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 64b81e80cf949ad98ace47b0bfdbe51815e34f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 35
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00afdf9f09b933f0bc6954f576be9400fc45cb
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 2de3757a0aed623e714d2a7ec71eb0c448611b
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 36
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f345740d5cfe4a662e5976e288e062251ef0cd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f825b06fb9856f2c19966c029ce49480ebfdf6
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 38
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0b95186261f56228d4a2ea3f5b775db056ff5a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a2213af2cab025173a2048df9c7892620aac04
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ de622fe5f0e9413ab31c470caad81e7d04d628
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 39
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 708f3768a2b40b86e797628b752f3542d31937
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a1c3512eb5abd37c557977793454be2fb41c1b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e5f580699f1001b08630a482be204adbc426c2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 13f90a773b0facb675bf5b1a8239c8f33d36f5
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dffb2c75f2c2597bc747d64c55028929c1aec5
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c1f9cfb261928772ee7db9178d84fb1d6e9861
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a9b0adf0c8e4db443baab46b410d177435bdf9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3e
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b652e6cc3294e4256523cf995dd0863bf140d4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3f1d8815f85f94d581d30a5368f92610823d7f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 795c4719a381185e1d5dde19cc57446a7b92cf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 43
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 15996943841cc3786a79ea7e75da20c3b4c0f5
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f752b362a7171fc3082ee213b39a89a77d233e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 44
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 33a9e2dcf80b5d027852fec66aedc0a4081419
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 45
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 62a4446e0cfd91a48927f5993f33e4b5a91a2a
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 47
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0a9f15697716a9333c28aedaa9a27cbf0dd0f9
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 5efcb7080478264baf7f470f7010561cc9b82f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 48
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 51e0ce64b2e9cc2a84534b3a5769121d0d61a2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 49
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 99f57fcccca993a99a91590d3e67f574958691
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4a
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 82067c6393bf10773e3f2bc5c01cb1f5d172a0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 40cf3b66c4cd1859a7b09996e8f553ac9081b2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 274d9941dd1aa01b02d879024f35f8432eaceb
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 59dfb5d468d4900302b3c54d77f79f49cf2ae7
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 8169b5975cf154cc5108b4bdfc7f2bb4941783
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4d
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3e60c0ab8df919b259e85ef5dbfeca805f5024
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 72bcc0916491a2d79d8991576ef4cd047e5256
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7f5f66f495830e43b101040ee4119ee778b13d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 8ac67ae9af5fac962ad54466be430d83722720
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1ca65f38f890868fc09edbb416fd56691c4a98
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8128c13ee1f30c70773245b478c73d97068834
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d0c80be3ce06a7227dd64672065059ee82a46c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e3df39c2b9cfc5412e3f44c96fc52b3a766662
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 50
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1681935a10848a742f4734a29e1eb54c3741e0
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f654f106d61febdd8e3f458595c3d906ad6ee8
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 51
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 131b825c832aa9eab3694152db63bf82f95cf9
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4fa32bdfba678418e8257935069d9b99176e61
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 74b28c565c285e3e312ec5178be64fbeca8398
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 52
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 7b05f291fdd7cf1213ff5b485f837b62a7bed4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 53
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bb8bade75b6c3696aeb1a1d3d6062ec22a0fe8
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 54
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1fb8ff03f7a96c8aae773953290e5cb3efb8b4
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f703ad0731034831e268a2baf07dcb35630d6a
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 56
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 7f17b0d7c7fb662c16d4357dd74830caf2dccb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 57
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ad22ccf8283e658b9faca9e1120b93c8527b28
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 58
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bd66e222ef2690c5141a8d9bb965182ffd755b
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1d75d065e5e15ebb4b715d89c33745b2b4fe7b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fabbcc49de92848f355737f448a51be4b77c2c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b532756e4e8d66bcc7e3aff713e40f93643587
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ be8363c0fa0773c1053d24163941d972091f5e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5d
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4bf334306b76a2d560210c0ae495be7490dcf6
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ edd03103f0b96f6fb1804b8fb6585759194c85
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ee72c7a991a38e93be8f14616e15669cc7d2fb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5e
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f6a520780202a1d6addd833d800ccb1ecac0bb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 9338e1e57273fcc15065c07ba742e7d85cd21a
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 60
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 3529b3ff040734310385de5d6e10a43f7825f2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 61
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 925ebd9473a5264094d2abfdc540521a9cfdbc
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bd35d411b806c2baf9ae4bc74c9d65af087d99
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e36849cf7cfa9f1f71b4a3964a4953e3e243d3
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e581b98275acc8ea1eb4aed49d69f8aedca80d
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 62
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b072941ec1d1a263e8236ece19c0449509b708
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c03e7f0e8507413c49d79bb24bf3c25aec797f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c687561adcaf4f2f55638a5af80236bf5c70ae
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fdd33153bb1bb0f61c7820738cb6fc485057c0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 63
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 7468941006f41bbe515470e69b60ce2756b50c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 64
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 6dd9c4a73fadd9e06b216d123b1576e6c9f0fb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 65
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b67c55f602d788bbfdc8051307a2083f346e7b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b8bace8f5a2fa3364240b1a24f62b8ec3d04b4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 67
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7b580ec7e529bf6126a1ab076169c18f2601d5
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f2df0015a3ac5252d4b8eef4cb3eae8b2edd82
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 68
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 314a9ada144cb2905e8b7ec5dd2470caa0aa80
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 69
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3d40c739d65e11ab90857b9d08c01003dab9d1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6c7fac44397c7e0524411e1f6e3c84ede5031c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8d402e602c49dedaa37ec5fff294bc00322464
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bb98fd900582a80fd8f30f4f6c768ba90b05f8
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6a
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c5bdf674999accb0a886a0073a9e8d56c39c31
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b148f7ce15bba64bd95c1efe14e275448cc4b0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6a18573bce17a8c8fd81f8a261224b019e6b53
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8a26247536aacbd255fdeef489ef96f940242a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c650b181b8802678414eb38578a5f6fcb378c0
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cdd16acbe992989fd60f86fce7572fbc2b8457
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6d
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8528a8aaa9232337743c16c47a47a14a8b90f0
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ec08c3288ebb44f1c973ae8378e747bcbd831d
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4db68bf040562147487696f7682f0fcaaf38fc
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 8b054637d6464bb59541bbfe5e96595b0ac9b0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00e7c197c9cccef3f77871243e772cfc178073
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2fc59dafa59fa1ac95d15036e63068dbcf50d1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9460110fa10f09b7384eeed6530244494cb59b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d38a0376292147428995a2261054daf6b542c4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 70
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1f624c6222b52b2ef34a10cca7d1d768ffe69b
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 53ebdab5909131d942fe35697a7748b6d6f37a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6e59b6b961a3a6fc0cf8f2ea1a1de27b995c07
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 84550fcb65e233aaa8d7f1e8079ee4d0f90899
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e776f2ae54982fd8091152aa8d941a95cf5cec
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 71
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 08a7455ac3521cfb2dc6f65dcf1099e219c2da
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8d6fea4835ec2d246af9800eddb7ffb276240c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b887a4d3957ba19e64e3a904eb7de62b1379c4
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dacfcb3c1f7b6e3f9a285dd40e21208577c221
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 72
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 91eaf9c03a77276ff7c6bc0fa0fd76c41193fb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 73
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ df25bfa4202bdd9e126c1125fc19e18af8e49d
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 75
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 0fbf3bd2034fc0339e00137bd1aa625ecc2550
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 76
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5afd7191f0a5a263c1406e41fea92d89b68744
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e9cf9a49313c468c7a25c39c22eb17260059ed
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 77
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 053960334e2e34dc584dea8019925c3b4ccca9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 78
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 899f1de8f8620147083721474ce663692aa14f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 79
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b95ec71a8e1a170c43ae3eac3c573136ec945b
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3a3344852b951510c7b37480df7a230ba7d3fc
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 4d45340d501eaaa7d4e6e12a4632ba8fe49500
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 68610739e1fcda271958847deb1450707a0abb
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 98de0603b7b70a66afb32a51e75ee64fcfb6e1
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a60dcec011d7fe07df55a3460f54144693c715
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 80
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 307e031220d9287df6c8210b145f1bc11b3c82
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d9a039a54ad64e04b96a461c973f3810c9468c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 82
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0c7bfa7f19058c55dc962f54619019f6076d14
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e150d81b28a737f8f05ae89267770c60c7faaa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 83
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 0208aa3b69ea36173970f13b56128a201da103
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 84
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 25971febcb78d372c790dd79ae92bf1dd17114
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ da5efb62c34058c822cf55e84b2e2e37e512db
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 85
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 9f85ac590a98c1ca6f0141acd0d6fdcd1ce8c6
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 87
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 24663871e69a5ddb00260615e14f2c77718cc2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 70f254e209aca2304a1e8436a2bb082ceddbec
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b57fa1adc8c0c32cb00fa3f558742b473a0b38
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 88
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9f96713fc47f964a3b756114e07d25f6067865
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d050b1908057b53d38b42702ebc659e3d7f696
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 89
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 711140ffdc55edf3535e46d666652f94483b9e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 233efe36b8788b93fb30068ba821d7b25d795b
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 595ce74ddc509cf445afcfdf56a19e46b9adb8
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f9b4522d82e78bf661ea7599048bc17050f91f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 68db77089294cb4f34409f8507dd639ce8aea9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 5adede09c5f7b2a15a10e67a188afd31950770
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1525d8d8d2d073770f0c8af0445641a029dd87
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5db4f5df8d2f78ad6ed6ee52f4631bb8d06e11
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 80aaaff97a1bfe6b4d753625085944568a1363
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c1aa288c105c33a9e6a17f51614b2ae559d9c5
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 92
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0d1851956905c031a7b99124fc864a2e0f9eb9
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dc0cf707480e9bf4517198db9b0cb3e8a9d2fa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 94
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 51a8f3e3588f383bb93711e0772a33bbfcccb0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 95
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fcdab10ee521da7fea7417812b63e2566635e7
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 96
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c961613ff1605d56cea4a36cd54bfc32a22162
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 97
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 3df98d62fa9c685a6fab5633ab794cee53ece8
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 99
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2428cd58c0cf84de0b8c8e5157c7f7f5675924
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9fa6c15c75cfaea7c509843fc7500a4d223056
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e515b28b4036300b38267649774650be6fdca1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9a
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e2ad84233ef97092ffd3fd8e0d0905fecd93b9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9b
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 26ad3414c99b7a31852a97b3026fc90cbd3379
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 317fff1b90f99f948bdeff9ac806c35b1b8957
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 76c60214d033f75d9d9460463d9ccf67acf9fd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f1a7fc2f312b8eb5a48675ad21041de50fc5e4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 26dfeeb6e641a33dae4961196235bdb965b21b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 91b6a697269bae99bec2bcdd93b4b625a64564
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ff0be18a7cc4adbec703370de0699e0e2b8035
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a0
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 22f5afabf0a1817b50cb3bdf214b2ec24450c6
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 59e66c323f9a0602ea58c2213e0e5c887c2d03
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a2d622b94c09d9fdb24ee3c4a543568b4516d8
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c9b38cd3933c6f42e652b63149a5e71d17caa1
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f1371cbd80f4b87c71a4c5a8d1ca3098d11369
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6a0f6774d196847097b42a7b1fb209198b5311
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dc41ecee5ec435200fe7cba2bde4107f823774
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a3
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6a22742ce6d02c8c2a92a3c18bf17df346349a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 9663e34765a9491e1fd2702bb07c60fd2a7cf3
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f9e2d2704038a10b168b1d6be7e004ae6292d1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a5
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0c52fecede06e6be8828ac13c32a6cae53b9c3
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 6967e5f6925a30da01bf8a2fd2b4d3c90212d5
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a6
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 14c93bc6f69d345145c3c542654967bc6a09fd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 94b225a1f288245f4d53944934154f68a09e78
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 57ac6488fb587d098e0c5427e26a5ed240920c
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bb40b77df91e4d94b01f27dcafd381d064a943
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c364ef11cf6287217c3893da5a6bc74110285c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aa
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ad6f9e6e9b2262b043340091540f96d909e849
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ab
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 35ea493266e71887e89fc54670a8a20762b598
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 84d5367e4576533bcace775fc9808d35659b5c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ac
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3010aaf318556fb8dad42c2c536c1aed11802b
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 54d8f9dd20d06aa3cb50cd88c9610fef438493
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5f774584a459947eba4ae6924c3cbffe795f3e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7948fbd8711b8ced7c3393a2731347361c0792
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ eb6b40bd52da1885bb93ce0376e2e801503e66
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ae
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 4af8a2d462370662d40d21e41e06b38ad5ec6b
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b0
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 43215504c26a302f47378a169a7fd92d071809
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 9512775e5ac76b11bb1893fc5dfeb8f2b18fa2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b1
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 79c0414b448240bb6b7edae5b985c3492e6e3f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b2a44f6ebc70c450043c05a002e7a93ba5d651
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b3
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5ffef1ae46f9e25de64e79e7f5313304f4084b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f6b7d796cc810c477568ce1c3fae6c1fcd6fab
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b4
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0d63d590fc272bc2e06ff11dbfc28c9a4eb4be
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 31b46901bb358d1cbc1ddfa38eabc5d0ef8e0a
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b5
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c00bffbb624b9f5075c4ec811a3460d07bffb9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b6
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 807fa1e0255e7564262a1eed638f835461ce98
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a00f96a9ad86187797fb06e59097bc5db83bbd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b792c5f81cca3d5930f481ad4739d247de0f0f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bcac4347fcd4179b38917e4777a25671492bc7
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b7
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c6aa4345283710fd0d2057224d0228604e4dd5
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 27122a52b9685eb556f43eb18f3ec03d9364c2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 29e25000fb383298f9ecf9410d67b64e8b39e9
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3c1a95cf725f54b89989cec9aaa72b5b13e9dd
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 60f2f1e5e356e8161ca7b31d23664903d03286
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a62350bdd39491de7f91cb17feff0476aec4ba
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aedb04de049fdf8c4b46cd4c86ad21364a3c2e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b9
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 72a336ac76e2b7561ff089f66be319826cf0f0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ba
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 512d945cb5e8ae6480ac980182580583cb1471
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bc
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ d20d50622030b045c6fafbc9d498f48274054c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 8e3ee190e25153dcece1cb7f7d9250a3965cb6
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ be
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 7664c777d57a57b2a11a6f43b121ded4445a71
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bf
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 53897f8dcd7f853a219b86f78e2dc880a4c9e1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 561a008ee7a1de93a7e72a96367d218acabf1e
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 5856c9e06d448c1cbdcf6b336943ddda564377
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c1
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 3ac22293ba01c82e7ea1f82e67208658f85465
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e599d835e5cae1bd4032bdfad977a1e8b77680
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c3
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2f10c10bbbb5c3a7341c115e0304e165ecbbb2
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 7c083502e03911e3a804136bfa2dccf3299fb8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 916e1cbd113afac45c720518158ff68cb64745
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cf3dc879480568aa6b18f55556a7d648c37b56
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c4
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3df598287bddf40922123f319fac304d4006b1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a6967055c1467d80d966d289614b9c5c10f1bb
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ afcda3cbf287268a5c2532ce4d6b0c141d9397
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b79bbc54166e31cde5b0ff7d8a6449ca02fe80
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cebbb656595b7e2689d0fdb6205549cfda6e6a
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c7
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 90ee2159fa8d433c9a9a359329db1830806da8
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3b8bde585180c668610ffd24c36ad0333cc79a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8f389de09f418da376598c42e8788d4fb6d172
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ eebc3b3e73d0d9de9c5d1290cd57c79b8c05a9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ca
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b8578683fd664da09c17300198ef8c1acc71de
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cb
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00b65b8267f131bba4574665e34e53e1d1641b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b2ccd2ac03c24767efbad394851c45db6ae934
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cc
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 046bfdb61be3306115a20bc91f9a126dc22392
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3675a32b2e303558947771ba7bd8f989900d38
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 501c035e59e25e1992562017720a7e5eddac40
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 43a3dfb9c40dda769b684e3aa5efbc34c97ee4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ce
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 891dfa9c5e080ab2571fcf2c82243db37b7267
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e0907b7e7cbc66a82b00933185a67456bd6115
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ b15609831558e3cf174cdff065fc3849a24a07
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d0
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 529914c4247adceb9e0efe33b2f5323f976d33
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ e06523feda206f9001f46cc14970dfe7bb9bc4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 461b41a3257d540e8f2d9751ed664c49a1e8d5
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d3
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ebd0a85b17f04b3c14c81a78e31593cfb976e9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d4
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 185a631d6561a74de83f1d6471482979747692
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eb1c32f75c809ad2c12d55950f4dd4869ae825
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f23458bb690a2b0a9f1c261227d22be92b861e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d5
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0081b62e4fac9753ed2d4432631703cfc06b79
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 98fa265bbb10b06e9e85415a28e0281b920b0f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d6
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 0fe3c09cbb3feb73af75e2df667d5667ec7567
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d7
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a7e233674fa7a1d33557b1661158e1d2a64186
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 62d8f80dcf116c148f59aeeaad9e55236cd5be
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d0be3730dc9be49a0568b506a6064d64d3fa3a
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f7ddc7a7cf8faa797a9f0fd2b1e56f43089dce
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d9
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2a30768993ed5daa7dafdf93f91f9cb0f1c581
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 351f4e6fd1a0f974151fe3c4169d86909d688b
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c9b360490816fba04aad77d674b8e5454c971b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ eecedba03e8cfdc49c57c52ee2468eef4aeb40
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ da
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 249d63ea71614a20a96e85d05fdb920b2b6d7a
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 94a6a6bd9a995b9e723b272b60b0adcd9ce200
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a4df17a92bd55571038d8d49de2da1c7adda7b
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dc
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 1b0e86c2a5918154f7b1207ff2ec526b859984
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ de
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f9f13c60a07a0fcd269f9cb13e199ec06f99b9
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ df
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 6c5ef7a8137627017248132e57f1bb1292bde1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 15bc4ccf138bbc38ad58ad57e92135484b3c0f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e5
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 44750e7fa925893d524e318fc8aa0075f8fa9f
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ed42749de21f0c22f9a7f0360671f5171e7c20
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e6
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 4cf6e3cbd001069367388c82ae42c9d68a53d4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e9
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 6c4a1785a0b6a994b620c9601c9b38add83e8e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a5271000d47bb187484a599af3b48c74ba8140
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ffa3083ad279ecf95fd8eae59cb253e9a539c4
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ed
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 49d17583eda5134e2339bedfa7455ff01553d5
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ abd1131859b6172c3de33f678cd1b5ec64dbd0
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ef
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 0f27144d47fdc9e6736d8afd15e2bf4bda034c
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a906a3c9129a272b7e6c1a7399caa8dbea2209
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f0
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3ee597143c968d01da4a75d93e94224519d8d1
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 6c16c4683b441de360ec26358120b5326fc66c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ a487b6bf0cec284f8cec392e661a2d4002b597
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f3
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bf5269c6d4f70f9ab7df745643cb9ac63d48dd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f4
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b82dd18861ecba6910474949825b9ff42b51ab
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ f09ba5e9061bbd9b5d05c9aed97d7bb09efc1c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f6
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 5934a5165a8c768442be1381847abdf22052fa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f7
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c3b49366c844d323c49b9096dee100847bd2e2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fa87eb875260ed98651bc419c8139b5119e554
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f8
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a22820db6e9db08bc546bb0e4726ccb754c527
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d53d0c7898a7d445c3218699c5d9237c710d7d
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ de00e530ec82458f0f64d340784c289d5f746f
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f9
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 54283ad2ea1e8a28d148155be2367063174334
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 70366eb8ab2ea9a7c4657e1cecea24ee8d2c00
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fb
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 60711b4a84d47476343658d4b12de639fb9073
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fc
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3d2ee52244729eb953c442e06ff640ed405a65
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 5da66087e6ddd135559b563892998a6eba3512
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 8638fef2619867c737c07e55a3da7bd6e36aa0
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ da7617f4555c1826cf6e0c3ac1607dd9d9f077
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fd
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cbd1aff894f31ebfe9e29331719b5ead3c60bd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fe
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ c93eccc9bfd9142908bf93fdd0d729f7da0c61
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ff
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b0ceb24de959555afe74dd0fb439f96a20868f
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c9ed7d54ed174ea20ef50f149f1b3487041e3b
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ efe900c5243fcf63eb76e2b84a5aa3990dbc06
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ info
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pack
‚îÇ   ‚îú‚îÄ‚îÄ ORIG_HEAD
‚îÇ   ‚îî‚îÄ‚îÄ refs
‚îÇ       ‚îú‚îÄ‚îÄ heads
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ develop
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ feature
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ disseny
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guia-landing-dashbaord-temas
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ intro
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ release
‚îÇ       ‚îú‚îÄ‚îÄ remotes
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ origin
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ develop
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ feature
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ disseny
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ guia-landing-dashbaord-temas
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ intro
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ HEAD
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ main
‚îÇ       ‚îî‚îÄ‚îÄ tags
‚îú‚îÄ‚îÄ .github
‚îÇ   ‚îî‚îÄ‚îÄ workflows
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .vscode
‚îÇ   ‚îî‚îÄ‚îÄ settings.json
‚îú‚îÄ‚îÄ AGENTS.md
‚îú‚îÄ‚îÄ codi_i_estructura_edutech.txt
‚îú‚îÄ‚îÄ content
‚îÇ   ‚îî‚îÄ‚îÄ legal
‚îú‚îÄ‚îÄ docs
‚îÇ   ‚îî‚îÄ‚îÄ TECH_SPECS.md
‚îú‚îÄ‚îÄ eslint.config.mjs
‚îú‚îÄ‚îÄ init-structure.js
‚îú‚îÄ‚îÄ merge.js
‚îú‚îÄ‚îÄ messages
‚îÇ   ‚îú‚îÄ‚îÄ ca.ts
‚îÇ   ‚îú‚îÄ‚îÄ en.ts
‚îÇ   ‚îî‚îÄ‚îÄ es.ts
‚îú‚îÄ‚îÄ next-env.d.ts
‚îú‚îÄ‚îÄ next.config.ts
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ pnpm-workspace.yaml
‚îú‚îÄ‚îÄ postcss.config.mjs
‚îú‚îÄ‚îÄ PRD.md
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [locale]
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ (admin)
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ admin
‚îÇ   ‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ topics
‚îÇ   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ users
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ (auth)
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ login
‚îÇ   ‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.tsx
‚îÇ   ‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ register
‚îÇ   ‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ RegisterForm.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ (dashboard)
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ dashboard
‚îÇ   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ (game)
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ arena
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ learn
‚îÇ   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ [slug]
‚îÇ   ‚îÇ       ‚îÇ           ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ       ‚îÇ           ‚îî‚îÄ‚îÄ play
‚îÇ   ‚îÇ       ‚îÇ               ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ api
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ webhooks
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ application
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard-topic.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ level-node.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session-result.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ use-cases
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ logout.use-case.test.ts
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ logout.use-case.ts
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ challenges
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ get-next-challenge.use-case.test.ts
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ get-next-challenge.use-case.ts
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dashboard
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ get-user-dashboard.use-case.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ gamification
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ complete-session.use-case.test.ts
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ complete-session.use-case.ts
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ topics
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ get-active-topics.use-case.test.ts
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ get-active-topics.use-case.ts
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ get-topic-path.use-case.ts
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ core
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challenge.entitiy.test.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challenge.entity.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ topic.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errors
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain-error.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ topic.errors.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user-not-found.error.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challenge.repository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ topic.repository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.repository.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ level-calculator.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types
‚îÇ   ‚îú‚îÄ‚îÄ i18n.ts
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adapters
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ challenge.repository.test.ts
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ challenge.repository.ts
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ topic.repository.ts
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ user.repository.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase-auth.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ supabase
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ server.ts
‚îÇ   ‚îú‚îÄ‚îÄ navigation.ts
‚îÇ   ‚îú‚îÄ‚îÄ presentation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ actions
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.action.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout.actions.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challenges
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ get-next-challenge.action.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gamification
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ submit-session.action.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ topics
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ get-topics.action.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LogoutButton.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ features
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TopicCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-engine
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChallengeRenderer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ challenges
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ code-fix
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CodeWindow.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HintPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SolutionDeck.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CodeFixView.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameArena.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameError.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameResult.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MatchingView.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QuizView.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leaderboard
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ learning-path
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LevelNode.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ topics
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TopicCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feedback
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DesktopNavbar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MobileBottomBar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ gamified
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ Button3D.tsx
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ LanguagerSwitcher.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ game
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ useGameSession.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ icon-mapper.tsx
‚îÇ   ‚îú‚îÄ‚îÄ proxy.ts
‚îÇ   ‚îî‚îÄ‚îÄ routing.ts
‚îú‚îÄ‚îÄ supabase
‚îÇ   ‚îú‚îÄ‚îÄ .branches
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _current_branch
‚îÇ   ‚îú‚îÄ‚îÄ .temp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cli-latest
‚îÇ   ‚îî‚îÄ‚îÄ snippets
‚îÇ       ‚îî‚îÄ‚îÄ Untitled query 908.sql
‚îú‚îÄ‚îÄ tests
‚îÇ   ‚îî‚îÄ‚îÄ e2e
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ vitest.config.ts


CONTINGUT DELS FITXERS


// =================== FILE: .vscode/settings.json ===================

{
  "files.associations": {
    "*.css": "tailwindcss"
  },
  "i18n-ally.localesPaths": [
    "messages"
],
  "i18n-ally.keystyle": "nested",
  "i18n-ally.sortKeys": true,
  "i18n-ally.namespace": true,
  "i18n-ally.pathMatcher": "{locale}.ts",
  "i18n-ally.enabledParsers": ["ts", "js", "json"]
}


// =================== FILE: init-structure.js ===================

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

// En la sintaxi moderna (ESM), __dirname no existeix per defecte,
// aix√≠ que el creem nosaltres manualment:
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// ==========================================
// DEFINICI√ì DE L'ARQUITECTURA (TECHMASTERY)
// ==========================================

const structure = [
  // --- ARREL I CONFIGURACI√ì ---
  '.github/workflows',
  '.vscode',
  'content/legal',
  'messages',
  'public/images/badges',
  'public/images/topics',
  'tests/e2e',

  // --- CAPA DE DOMINI (CORE) ---
  'src/core/entities',
  'src/core/repositories',
  'src/core/errors',
  'src/core/types',
  'src/core/services',

  // --- CAPA D'APLICACI√ì (USE CASES) ---
  'src/application/use-cases/auth',
  'src/application/use-cases/challenges',
  'src/application/use-cases/topics',
  'src/application/use-cases/gamification',
  'src/application/dto',

  // --- CAPA D'INFRAESTRUCTURA (ADAPTERS) ---
  'src/infrastructure/repositories/supabase',
  'src/infrastructure/adapters',
  'src/infrastructure/config',
  'src/infrastructure/database',

  // --- CAPA DE PRESENTACI√ì (UI & ACTIONS) ---
  'src/presentation/actions',
  'src/presentation/hooks',
  'src/presentation/utils',
  
  // Components UI
  'src/presentation/components/ui',
  'src/presentation/components/layout',
  'src/presentation/components/feedback',
  
  // Components de Features
  'src/presentation/components/features/auth',
  'src/presentation/components/features/topics',
  'src/presentation/components/features/leaderboard',
  'src/presentation/components/features/game-engine',
  'src/presentation/components/features/game-engine/challenges',
  
  // Components d'Administraci√≥
  'src/presentation/components/admin',

  // --- NEXT.JS APP ROUTER ---
  'src/app/[locale]/api/webhooks',
  'src/app/[locale]/(auth)',
  'src/app/[locale]/(dashboard)',
  'src/app/[locale]/(game)/learn',
  'src/app/[locale]/(game)/arena',
  'src/app/[locale]/(admin)/admin/topics',
  'src/app/[locale]/(admin)/admin/users',
];

const filesToCreate = [
  {
    path: 'messages/ca.json',
    content: `{
  "app": { "name": "TechMastery" },
  "game": { "start": "Comen√ßa", "check": "Comprovar" }
}`
  },
  {
    path: 'messages/en.json',
    content: `{
  "app": { "name": "TechMastery" },
  "game": { "start": "Start", "check": "Check" }
}`
  },
  {
    path: 'src/core/README.md',
    content: `# Core Layer (Domini)
Aquesta capa cont√© les regles de negoci pures del joc.
‚ö†Ô∏è NO importis res de React, Next.js o Supabase aqu√≠.`
  },
  {
    path: 'src/application/README.md',
    content: `# Application Layer (Casos d'√ös)
Aqu√≠ resideix l'orquestraci√≥ de l'aplicaci√≥.`
  },
  {
    path: 'src/presentation/components/features/game-engine/README.md',
    content: `# Game Engine Components
Components polim√≤rfics per a Quiz, Terminal, etc.`
  },
  {
    path: 'src/app/globals.css',
    content: `@tailwind base;\n@tailwind components;\n@tailwind utilities;`
  }
];

console.log('üöÄ Iniciant creaci√≥ d\'estructura Enterprise (ESM)...\n');

// 1. CREACI√ì DE CARPETES
structure.forEach(dir => {
  const fullPath = path.join(__dirname, dir);
  if (!fs.existsSync(fullPath)) {
    fs.mkdirSync(fullPath, { recursive: true });
    console.log(`‚úÖ Carpeta creada: ${dir}`);
  }
});

// 2. CREACI√ì D'ARXIUS BASE
filesToCreate.forEach(file => {
  const fullPath = path.join(__dirname, file.path);
  if (!fs.existsSync(fullPath)) {
    const dirName = path.dirname(fullPath);
    if (!fs.existsSync(dirName)) {
      fs.mkdirSync(dirName, { recursive: true });
    }
    fs.writeFileSync(fullPath, file.content);
    console.log(`üìÑ Fitxer creat: ${file.path}`);
  }
});

console.log('\nüéâ ESTRUCTURA COMPLETADA!');

// =================== FILE: merge.js ===================

import { readdirSync, statSync, readFileSync, writeFileSync } from "fs";
import { join, extname } from "path";

// --- Configuraci√≥ ---
const rootFolder = "./";
const outputFile = "codi_i_estructura_edutech.txt";
const extensionsToInclude = [".ts", ".tsx", ".js", ".jsx", ".css", ".json", ".sql"];

const ignoreList = [
  "public",
  "node_modules",
  ".next",
  "dist",
  "build",
  ".DS_Store",
  "package-lock.json",
  "pnpm-lock.yaml",
];

let treeOutput = `ESTRUCTURA DEL PROJECTE (./src)\n\n`;
let contentOutput = "\n\nCONTINGUT DELS FITXERS\n";

function processDirectory(dir, prefix = "") {
  // Llegim i filtrem els arxius i carpetes del directori actual
  const items = readdirSync(dir).filter(item => !ignoreList.includes(item));

  items.forEach((item, index) => {
    const fullPath = join(dir, item);
    const stat = statSync(fullPath);
    const isLast = index === items.length - 1;

    // Afegim la l√≠nia corresponent a l'arbre de directoris
    treeOutput += `${prefix}${isLast ? "‚îî‚îÄ‚îÄ " : "‚îú‚îÄ‚îÄ "}${item}\n`;

    if (stat.isDirectory()) {
      // Si √©s un directori, fem la crida recursiva amb el nou prefix
      const newPrefix = prefix + (isLast ? "    " : "‚îÇ   ");
      processDirectory(fullPath, newPrefix);
    } else if (extensionsToInclude.includes(extname(item))) {
      // Si √©s un fitxer v√†lid, llegim el seu contingut
      const normalizedPath = fullPath.replace(/\\/g, "/");
      contentOutput += `\n\n// =================== FILE: ${normalizedPath} ===================\n\n`;
      contentOutput += readFileSync(fullPath, "utf8");
    }
  });
}

try {
  console.log("üå≥ Generant l'arbre de directoris i llegint fitxers...");
  processDirectory(rootFolder);

  // Unim l'arbre i el contingut en un sol fitxer
  const finalOutput = treeOutput + contentOutput;

  writeFileSync(outputFile, finalOutput);
  console.log(`‚úÖ Fitxer creat amb √®xit: ${outputFile}`);
} catch (error) {
  console.error("‚ùå Hi ha hagut un error en crear el fitxer:", error);
}

// =================== FILE: messages/ca.ts ===================

// filepath: messages/ca.ts
export default {
  app: {
    name: "TechMastery"
  },
  game: {
    start: "Comen√ßa",
    check: "Comprovar",
    next: "Seg√ºent",
    finish: "Acabar",
    loading: "Carregant...",
    arena: {
      loading: "Guardant el teu progr√©s...",
      progress: "Progr√©s",
      construction: "En construcci√≥...",
      skip: "Saltar",
      unauthorized_title: "Inicia sessi√≥",
      unauthorized_desc: "Necessites un compte per guardar el teu progr√©s i pujar de nivell.",
      error_title: "Ups! Alguna cosa ha fallat",
      login_btn: "Entrar",
      retry_btn: "Reintentar",
      lesson_complete: "Lli√ß√≥ Completada!",
      xp_earned: "XP Guanyada",
      dashboard_btn: "Tornar al Dashboard",
      level_up: "NIVELL SUPERAT!",
      continue_btn: "Continuar" // <--- AFEGIR
    }
  },
  // AFEGEIX AIX√í:
  dashboard: {
    welcome_title: "Hola de nou",
    subtitle: "Quina tecnologia vols dominar avui?",
    availableTopics: "Temes Disponibles"
  },
  topic: {
    react: { title: "Fonaments de React" },
    typescript: { title: "TypeScript Pro" },
    supabase: { title: "Supabase i SQL" },
    legacy: { title: "PHP Legacy" },
    security: { title: "Seguretat OWASP" },
    docker: { title: "Contenidors Docker" }
  },

  // --- NOVA SECCI√ì AUTH ---
  auth: {
    login: {
      title: "Benvingut a eduTech üöÄ",
      subtitle: "Inicia sessi√≥ per continuar aprenent.",
      submit_button: "Entrar",
      forgot_password: "Has oblidat la contrasenya?",
      no_account: "Encara no tens compte?",
      register_link: "Crea un compte gratu√Øt"
    },
    register: {
      title: "Uneix-te a eduTech",
      subtitle: "Comen√ßa a aprendre avui mateix.",
      submit_button: "Crear Compte",
      have_account: "Ja tens compte?",
      login_link: "Inicia sessi√≥"
    },
    fields: {
      email: "Correu electr√≤nic",
      email_placeholder: "usuari@exemple.com",
      password: "Contrasenya",
      password_placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
    },
    errors: {
      generic: "Hi ha hagut un error inesperat.",
      invalid_credentials: "El correu o la contrasenya s√≥n incorrectes.",
      user_already_exists: "Aquest correu ja est√† registrat.",
      weak_password: "La contrasenya ha de tenir m√≠nim 6 car√†cters."
    },
    success: {
      check_email: "Compte creat! Revisa el teu correu."
    },
    logout: "Tancar Sessi√≥"
  },
  landing: {
    badge: "Apr√®n programaci√≥ jugant",
    title_prefix: "Converteix-te en",
    title_highlight: "Senior Developer",
    description: "Domina React, Docker i Ciberseguretat amb reptes interactius. Sense v√≠deos avorrits. Nom√©s pr√†ctica real.",
    cta_primary: "COMEN√áAR GRATIS",
    cta_secondary: "SABER-NE M√âS",
    login_button: "ENTRAR"
  }
} as const;

// =================== FILE: messages/en.ts ===================

// filepath: messages/en.ts
export default {
  app: {
    name: "TechMastery"
  },
  game: {
    start: "Start",
    check: "Check",
    next: "Next",
    finish: "Finish",
    loading: "Loading...",
    arena: {
      loading: "Saving your progress...",
      progress: "Progress",
      construction: "Under construction...",
      skip: "Skip",
      unauthorized_title: "Log in",
      unauthorized_desc: "You need an account to save your progress and level up.",
      error_title: "Oops! Something went wrong",
      login_btn: "Log in",
      retry_btn: "Retry",
      lesson_complete: "Lesson Completed!",
      xp_earned: "XP Earned",
      dashboard_btn: "Back to Dashboard",
      level_up: "LEVEL UP!",
      continue_btn: "Continue" // <--- AFEGIR
    }

  },
  dashboard: {
    welcome_title: "Welcome back",
    subtitle: "What technology do you want to master today?",
    availableTopics: "Available Topics"
  },
  topic: {
    react: { title: "React Basics" },
    typescript: { title: "TypeScript Pro" },
    supabase: { title: "Supabase & SQL" },
    legacy: { title: "Legacy PHP" }, // Encara que estigui desactivat
    security: { title: "OWASP Top 10" }, // Exemple extra
    docker: { title: "Docker Containers" }
  },
  auth: {
    login: {
      title: "Welcome to eduTech üöÄ",
      subtitle: "Login to continue learning.",
      submit_button: "Login",
      forgot_password: "Forgot password?",
      no_account: "Don't have an account?",
      register_link: "Create free account"
    },
    register: {
      title: "Join eduTech",
      subtitle: "Start learning today.",
      submit_button: "Create Account",
      have_account: "Already have an account?",
      login_link: "Login"
    },
    fields: {
      email: "Email",
      email_placeholder: "user@example.com",
      password: "Password",
      password_placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
    },
    errors: {
      generic: "An unexpected error occurred.",
      invalid_credentials: "Invalid email or password.",
      user_already_exists: "Email already registered.",
      weak_password: "Password must be at least 6 characters."
    },
    success: {
      check_email: "Account created! Check your email."
    },
    logout: "Logout"
  },
  landing: {
    badge: "Learn coding by playing",
    title_prefix: "Become a",
    title_highlight: "Senior Developer",
    description: "Master React, Docker, and Cybersecurity with interactive challenges. No boring videos. Just real practice.",
    cta_primary: "START FOR FREE",
    cta_secondary: "LEARN MORE",
    login_button: "LOGIN"
  }
} as const;

// =================== FILE: messages/es.ts ===================

// filepath: messages/es.ts
export default {
  app: {
    name: "TechMastery"
  },
  game: {
    start: "Empezar",
    check: "Comprobar",
    next: "Siguiente",
    finish: "Finalizar",
    loading: "Cargando...",
    arena: {
      loading: "Guardando tu progreso...",
      progress: "Progreso",
      construction: "En construcci√≥n...",
      skip: "Saltar",
      unauthorized_title: "Inicia sesi√≥n",
      unauthorized_desc: "Necesitas una cuenta para guardar tu progreso y subir de nivel.",
      error_title: "¬°Ups! Algo ha fallado",
      login_btn: "Entrar",
      retry_btn: "Reintentar",
      lesson_complete: "¬°Lecci√≥n completada!",
      xp_earned: "XP ganada",
      dashboard_btn: "Volver al Dashboard",
      level_up: "¬°NIVEL SUPERADO!",
      continue_btn: "Continuar" // <--- AFEGIR
    }

  },
  dashboard: {
    welcome_title: "Hola de nuevo",
    subtitle: "¬øQu√© tecnolog√≠a quieres dominar hoy?",
    availableTopics: "Temas Disponibles"
  },
  topic: {
    react: { title: "Fundamentos de React" },
    typescript: { title: "TypeScript Pro" },
    supabase: { title: "Supabase y SQL" },
    legacy: { title: "PHP Legacy" },
    security: { title: "Seguridad OWASP" },
    docker: { title: "Contenedores Docker" }
  },
  auth: {
    login: {
      title: "Bienvenido a eduTech üöÄ",
      subtitle: "Inicia sesi√≥n para seguir aprendiendo.",
      submit_button: "Iniciar sesi√≥n",
      forgot_password: "¬øOlvidaste tu contrase√±a?",
      no_account: "¬øNo tienes una cuenta?",
      register_link: "Crear cuenta gratis"
    },
    register: {
      title: "√önete a eduTech",
      subtitle: "Empieza a aprender hoy.",
      submit_button: "Crear cuenta",
      have_account: "¬øYa tienes una cuenta?",
      login_link: "Iniciar sesi√≥n"
    },
    fields: {
      email: "Correo electr√≥nico",
      email_placeholder: "usuario@ejemplo.com",
      password: "Contrase√±a",
      password_placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
    },
    errors: {
      generic: "Ocurri√≥ un error inesperado.",
      invalid_credentials: "Correo electr√≥nico o contrase√±a incorrectos.",
      user_already_exists: "El correo electr√≥nico ya est√° registrado.",
      weak_password: "La contrase√±a debe tener al menos 6 caracteres."
    },
    success: {
      check_email: "¬°Cuenta creada! Revisa tu correo electr√≥nico."
    },
    logout: "Cerrar sesi√≥n"
  },
  landing: {
    badge: "Aprende programaci√≥n jugando",
    title_prefix: "Convi√©rtete en",
    title_highlight: "Senior Developer",
    description: "Domina React, Docker y Ciberseguridad con retos interactivos. Sin v√≠deos aburridos. Solo pr√°ctica real.",
    cta_primary: "EMPEZAR GRATIS",
    cta_secondary: "SABER M√ÅS",
    login_button: "ENTRAR"
  }
} as const;


// =================== FILE: next-env.d.ts ===================

/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.


// =================== FILE: next.config.ts ===================

import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./src/i18n.ts'); // Apunta al fitxer que crearem ara

/** @type {import('next').NextConfig} */
const nextConfig = {};

export default withNextIntl(nextConfig);

// =================== FILE: package.json ===================

{
  "name": "edu-tech",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "test": "vitest",
    "test:watch": "vitest --watch",
    "test:ci": "vitest run"
  },
  "dependencies": {
    "@supabase/ssr": "^0.8.0",
    "@supabase/supabase-js": "^2.90.1",
    "clsx": "^2.1.1",
    "framer-motion": "^12.24.11",
    "lucide-react": "^0.562.0",
    "next": "16.1.1",
    "next-intl": "^4.7.0",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "tailwind-merge": "^3.4.0",
    "zod": "^4.3.5"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/react": "^16.3.1",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@vitejs/plugin-react": "^5.1.2",
    "dotenv": "^17.2.3",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "jsdom": "^27.4.0",
    "tailwindcss": "^4",
    "tailwindcss-animate": "^1.0.7",
    "typescript": "^5",
    "vite-tsconfig-paths": "^6.0.3",
    "vitest": "^4.0.16"
  }
}

// =================== FILE: src/app/globals.css ===================

/* filepath: src/app/globals.css */
@import "tailwindcss";
@plugin "tailwindcss-animate";

@theme {
  --font-sans: var(--font-nunito), ui-sans-serif, system-ui;

  /* Colors Brand */
  --color-brand-primary: #3B82F6;
  --color-brand-primaryDark: #1D4ED8;
  --color-brand-success: #58CC02;
  --color-brand-successDark: #46A302;
  --color-brand-danger: #FF4B4B;
  --color-brand-dangerDark: #D62F2F;
  --color-brand-warning: #FFC800;
  --color-brand-warningDark: #D9AA00;
  --color-brand-surface: #1E293B;
  --color-brand-surfaceDark: #0F172A;

  --animate-bounce-sm: bounce-sm 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  @keyframes bounce-sm {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(0.95); }
  }
}

@layer components {
  /* TRUC: En lloc de fer @apply btn-game a tot arreu, 
     apliquem els estils base a TOTS els botons de cop.
  */
  .btn-game, 
  .btn-primary, 
  .btn-success, 
  .btn-danger, 
  .btn-outline {
    @apply relative w-full py-4 px-6 rounded-2xl font-black text-lg uppercase tracking-wider transition-all active:translate-y-1 active:border-b-0 cursor-pointer flex items-center justify-center gap-2;
  }

  /* Ara nom√©s definim els colors espec√≠fics per cada variant */
  .btn-primary {
    @apply bg-brand-primary text-white border-b-4 border-brand-primaryDark hover:bg-blue-400;
  }
  
  .btn-success {
    @apply bg-brand-success text-white border-b-4 border-brand-successDark hover:bg-green-400;
  }

  .btn-danger {
    @apply bg-brand-danger text-white border-b-4 border-brand-dangerDark hover:bg-red-400;
  }

  .btn-outline {
    @apply bg-slate-800 text-slate-300 border-2 border-b-4 border-slate-700 hover:bg-slate-700;
  }

  /* Inputs */
  .input-game {
    @apply w-full p-4 bg-slate-800 border-2 border-slate-700 rounded-xl text-white font-bold placeholder-slate-500 focus:outline-none focus:border-brand-primary focus:bg-slate-900 transition-all;
  }
}

// =================== FILE: src/app/layout.tsx ===================

// filepath: src/app/layout.tsx
import { ReactNode } from 'react';

// Aquest layout √©s necessari per Next.js per√≤ no ha de fer RES visualment
// perqu√® tota la teva app viu dins de /[locale]/
export default function RootLayout({ children }: { children: ReactNode }) {
  return children;
}

// =================== FILE: src/app/[locale]/(auth)/layout.tsx ===================

// filepath: src/app/[locale]/(auth)/layout.tsx
import { ReactNode } from 'react';

export default function AuthLayout({ children }: { children: ReactNode }) {
  return (
    <div className="min-h-screen w-full flex items-center justify-center bg-slate-950 relative overflow-hidden">
      {/* Fons decoratiu (Opcional: efecte grid o gradient) */}
      <div className="absolute inset-0 bg-[linear-gradient(to_right,#4f4f4f2e_1px,transparent_1px),linear-gradient(to_bottom,#4f4f4f2e_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)]" />
      
      {/* Contingut centrat (Login/Register) */}
      <div className="relative z-10 w-full max-w-md p-4">
        {children}
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/(auth)/login/LoginForm.tsx ===================

// filepath: src/app/[locale]/(auth)/login/LoginForm.tsx
'use client';

import { useActionState } from 'react';
import { authAction } from '@/presentation/actions/auth/auth.action';
import { Loader2, LogIn } from 'lucide-react';
import { useTranslations } from 'next-intl';

// 1. IMPORTACI√ì CORRECTA (Arquitectura Centralitzada)
import { Link } from '@/navigation'; 

export function LoginForm() {
  const t = useTranslations('auth');
  
  // 2. HEM ELIMINAT 'const locale = useLocale();' -> Ja no cal!

  const [state, action, isPending] = useActionState(authAction, {});

  return (
    <form action={action} className="flex flex-col gap-4">
      <input type="hidden" name="intent" value="login" />

      {/* EMAIL */}
      <div>
        <label className="block text-sm font-medium text-slate-400 mb-1">
          {t('fields.email')}
        </label>
        <input 
          name="email" 
          type="email" 
          required 
          className="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"
          placeholder={t('fields.email_placeholder')}
        />
      </div>
      
      {/* PASSWORD */}
      <div>
        <label className="block text-sm font-medium text-slate-400 mb-1">
          {t('fields.password')}
        </label>
        <div className="text-right mb-1">
            {/* TODO: Crear ruta real /forgot-password */}
            <Link href="/forgot-password" className="text-xs text-blue-400 hover:underline">
              {t('login.forgot_password')}
            </Link>
        </div>
        <input 
          name="password" 
          type="password" 
          required 
          minLength={6}
          className="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"
          placeholder={t('fields.password_placeholder')}
        />
      </div>

      {/* ERRORS */}
      {state?.errorKey && (
        <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2">
          ‚ö†Ô∏è <span>{t(state.errorKey)}</span>
        </div>
      )}

      {/* BOT√ì */}
      <button 
        type="submit" 
        disabled={isPending}
        className="w-full py-3 mt-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-all flex justify-center items-center shadow-lg shadow-blue-900/20"
      >
        {isPending ? <Loader2 className="animate-spin w-5 h-5" /> : (
            <span className="flex items-center gap-2">
                {t('login.submit_button')} <LogIn className="w-4 h-4" />
            </span>
        )}
      </button>

      {/* FOOTER LINK - MOLT M√âS NET */}
      <div className="text-center mt-6 text-sm text-slate-500">
        {t('login.no_account')}{' '}
        <Link 
          href="/register" 
          className="text-blue-400 hover:text-blue-300 font-medium hover:underline transition-colors"
        >
          {t('login.register_link')}
        </Link>
      </div>
    </form>
  );
}

// =================== FILE: src/app/[locale]/(auth)/login/page.tsx ===================

// filepath: src/app/[locale]/(auth)/login/page.tsx
import { LoginForm } from './LoginForm';
import { getTranslations } from 'next-intl/server'; // <--- Import de servidor

interface Props {
  params: Promise<{ locale: string }>;
}

export default async function LoginPage({ params }: Props) {
  // 1. Esperem els par√†metres (Next.js 15 requires await)
  const { locale } = await params;
  
  // 2. Carreguem les traduccions al servidor
  const t = await getTranslations({ locale, namespace: 'auth.login' });

  return (
    <div className="bg-slate-900 border border-slate-800 rounded-xl p-8 shadow-2xl backdrop-blur-sm w-full">
      <div className="text-center mb-8">
        <h1 className="text-3xl font-bold text-white mb-2">{t('title')}</h1>
        <p className="text-slate-400">{t('subtitle')}</p>
      </div>

      <LoginForm />
    </div>
  );
}

// =================== FILE: src/app/[locale]/(auth)/register/page.tsx ===================

// filepath: src/app/[locale]/(auth)/register/page.tsx
import { RegisterForm } from './RegisterForm';
import { getTranslations } from 'next-intl/server';

interface Props {
  params: Promise<{ locale: string }>;
}

export default async function RegisterPage({ params }: Props) {
  const { locale } = await params;
  
  // namespace 'auth.register' coincideix amb el teu fitxer .ts
  const t = await getTranslations({ locale, namespace: 'auth.register' });

  return (
    <div className="bg-slate-900 border border-slate-800 rounded-xl p-8 shadow-2xl backdrop-blur-sm w-full">
      <div className="text-center mb-8">
        <h1 className="text-3xl font-bold text-white mb-2">{t('title')}</h1>
        <p className="text-slate-400">{t('subtitle')}</p>
      </div>
      <RegisterForm />
    </div>
  );
}

// =================== FILE: src/app/[locale]/(auth)/register/RegisterForm.tsx ===================

// filepath: src/app/[locale]/(auth)/register/RegisterForm.tsx
'use client';

import { useActionState } from 'react';
import { authAction } from '@/presentation/actions/auth/auth.action';
import { Loader2 } from 'lucide-react';
import { useTranslations } from 'next-intl';

// 1. IMPORTACI√ì CORRECTA
import { Link } from '@/navigation';

export function RegisterForm() {
  const t = useTranslations('auth');
  // 2. HEM ELIMINAT 'const locale = useLocale();'

  const [state, action, isPending] = useActionState(authAction, {});

  return (
    <form action={action} className="flex flex-col gap-4">
      <input type="hidden" name="intent" value="signup" />

      {/* EMAIL */}
      <div>
        <label className="block text-sm font-medium text-slate-400 mb-1">
          {t('fields.email')}
        </label>
        <input 
          name="email" 
          type="email" 
          required 
          className="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"
          placeholder={t('fields.email_placeholder')} 
        />
      </div>

      {/* PASSWORD */}
      <div>
        <label className="block text-sm font-medium text-slate-400 mb-1">
          {t('fields.password')}
        </label>
        <input 
          name="password" 
          type="password" 
          required 
          minLength={6} 
          className="w-full p-3 bg-slate-950 border border-slate-800 rounded-lg text-white focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"
          placeholder={t('fields.password_placeholder')} 
        />
      </div>

      {/* MISSATGES */}
      {state?.errorKey && (
        <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm">
          ‚ö†Ô∏è {t(state.errorKey)}
        </div>
      )}
      {state?.messageKey && (
        <div className="p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-400 text-sm">
          ‚úÖ {t(state.messageKey)}
        </div>
      )}

      {/* BOT√ì */}
      <button 
        disabled={isPending} 
        className="w-full py-3 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 text-white font-bold rounded-lg transition-all flex justify-center items-center shadow-lg"
      >
        {isPending ? <Loader2 className="animate-spin" /> : t('register.submit_button')}
      </button>

      {/* FOOTER - SENSE LOCALE MANUAL */}
      <div className="text-center mt-4 text-sm text-slate-500">
        {t('register.have_account')}{' '}
        <Link 
          href="/login" 
          className="text-blue-400 hover:underline"
        >
          {t('register.login_link')}
        </Link>
      </div>
    </form>
  );
}

// =================== FILE: src/app/[locale]/(dashboard)/dashboard/page.tsx ===================

// filepath: src/app/[locale]/(dashboard)/dashboard/page.tsx
import { createClient } from '@/infrastructure/utils/supabase/server';
import { SupabaseTopicRepository } from '@/infrastructure/repositories/supabase/topic.repository';
import { GetUserDashboardUseCase } from '@/application/use-cases/dashboard/get-user-dashboard.use-case';
import { TopicCard } from '@/presentation/components/features/dashboard/TopicCard';
import { getTranslations } from 'next-intl/server'; // <--- Import
import { redirect } from 'next/navigation';

interface DashboardPageProps {
    params: Promise<{ locale: string }>;
}

export default async function DashboardPage({ params }: DashboardPageProps) {
  const { locale } = await params;
  
  // 1. CARREGAR TOTES LES TRADUCCIONS (sense namespace espec√≠fic)
  // Aix√≠ podem fer t('dashboard.welcome_title') i tamb√© t('topic.react.title')
  const t = await getTranslations(); 
  
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    redirect('/login');
  }

  const topicRepo = new SupabaseTopicRepository();
  const useCase = new GetUserDashboardUseCase(topicRepo);
  const topics = await useCase.execute(user.id, locale, supabase);

  return (
    <div className="min-h-screen bg-slate-950 p-6 md:p-12">
      <div className="max-w-6xl mx-auto mb-10">
        <h1 className="text-3xl md:text-4xl font-black text-white mb-2 tracking-tight">
           {t('dashboard.welcome_title')}, <span className="text-blue-500">{user.email?.split('@')[0]}</span>! üëã
        </h1>
        <p className="text-slate-400 text-lg">
           {t('dashboard.subtitle')}
        </p>
      </div>

      <div className="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
         {topics.map((topic) => (
             <TopicCard 
                key={topic.id} 
                topic={topic} 
                // AQU√ç FEM LA TRADUCCI√ì DIN√ÄMICA
                // Si la clau (topic.nameKey) no existeix, next-intl retornar√† la clau com a fallback
                translatedTitle={t(topic.nameKey)} 
             />
         ))}
      </div>

      {topics.length === 0 && (
          <div className="text-center py-20">
             <p className="text-slate-500">No s'han trobat temes actius.</p>
          </div>
      )}
    </div>
  );
}

// =================== FILE: src/app/[locale]/(game)/learn/[slug]/page.tsx ===================

// filepath: src/app/[locale]/(game)/learn/[slug]/page.tsx
import { createClient } from '@/infrastructure/utils/supabase/server';
import { GetTopicPathUseCase } from '@/application/use-cases/topics/get-topic-path.use-case';
import { SupabaseTopicRepository } from '@/infrastructure/repositories/supabase/topic.repository';
import { LevelNode } from '@/presentation/components/features/learning-path/LevelNode';
import { ArrowLeft } from 'lucide-react';
import { redirect } from 'next/navigation';
import { getTranslations } from 'next-intl/server';
import { Link } from '@/navigation'; 

interface TopicPageProps {
  params: Promise<{ slug: string; locale: string }>;
}

export default async function TopicMapPage({ params }: TopicPageProps) {
  const { slug } = await params;
  const t = await getTranslations(); 
  const supabase = await createClient();

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) redirect('/login');

  // 1. Instanciem el Repo
  const topicRepo = new SupabaseTopicRepository();
  const topic = await topicRepo.findBySlug(slug);
  
  if (!topic) {
    return <div className="text-white text-center pt-20">Tema no trobat 404</div>;
  }

  // 2. CORRECCI√ì CR√çTICA: Passem 'topicRepo' al constructor
  const pathUseCase = new GetTopicPathUseCase(topicRepo);
  
  // 3. CORRECCI√ì: Ja no passem 'supabase' a l'execute
  const { levels, totalXp } = await pathUseCase.execute(user.id, topic.id);

  return (
    <div className="min-h-screen bg-slate-950 flex flex-col items-center pb-20 relative overflow-hidden">
      
      {/* HEADER FLOTANT */}
      <header className="sticky top-0 z-50 w-full bg-slate-900/80 backdrop-blur-md border-b border-slate-800 p-4 flex items-center justify-between">
         <Link href="/dashboard" className="text-slate-400 hover:text-white transition-colors">
            <ArrowLeft className="w-6 h-6" />
         </Link>
         
         <h1 className="font-bold text-white text-lg tracking-tight">
            {t(topic.nameKey)}
         </h1>
         
         <div className="text-sm font-bold text-yellow-500 bg-yellow-500/10 px-3 py-1 rounded-full border border-yellow-500/20">
            {totalXp} / {levels.length > 0 ? '?' : 0} 
            {/* Petit canvi visual, pots posar el que vulguis aqu√≠ */}
         </div>
      </header>

      {/* FONS CAM√ç (SVG LINE) */}
      <div className="absolute top-0 w-full h-full flex justify-center pointer-events-none opacity-20">
         <svg className="h-full" width="200" height="100%">
            <line x1="100" y1="0" x2="100" y2="100%" stroke="currentColor" strokeWidth="10" className="text-slate-800" strokeDasharray="20,10" />
         </svg>
      </div>

      {/* LLISTA DE NIVELLS (CAM√ç) */}
      <div className="flex flex-col gap-8 mt-12 w-full max-w-md px-4 relative">
          {levels.map((level, index) => (
             <LevelNode 
                key={level.tier} 
                tier={level.tier} 
                status={level.status} 
                slug={slug}
                index={index}
             />
          ))}
          
          <div className="flex justify-center mt-8 opacity-50">
             <div className="w-32 h-32 border-4 border-dashed border-slate-800 rounded-full flex items-center justify-center text-slate-700 font-black text-2xl">
                BOSS
             </div>
          </div>
      </div>
    </div>
  );
}

// =================== FILE: src/app/[locale]/(game)/learn/[slug]/play/page.tsx ===================

// filepath: src/app/[locale]/(game)/learn/[slug]/play/page.tsx
import { getNextChallengeAction } from '@/presentation/actions/challenges/get-next-challenge.action';
import { GameArena } from '@/presentation/components/features/game-engine/GameArena';
// 1. IMPORT CORRECTE PER A i18n
import { Link } from '@/navigation';
import { ArrowLeft } from 'lucide-react';

interface PlayPageProps {
  params: Promise<{ slug: string; locale: string }>;
  searchParams: Promise<{ tier?: string }>;
}

export default async function PlayPage({ params, searchParams }: PlayPageProps) {
  const { slug } = await params;
  const { tier } = await searchParams;

  // 2. Determinar Dificultat (Tier)
  const difficulty = tier ? parseInt(tier, 10) : 1;

  // 3. Cridar l'Acci√≥ passant el NIVELL
  // (Nota: Ara haurem d'actualitzar l'acci√≥ per acceptar aquest par√†metre)
  const response = await getNextChallengeAction(slug, difficulty);

  return (
    <main className="min-h-screen bg-slate-950 flex flex-col">
      {/* HEADER DE JOC */}
      <header className="border-b border-slate-800 bg-slate-900/80 backdrop-blur-md p-4 sticky top-0 z-20">
        <div className="max-w-5xl mx-auto flex items-center justify-between">

          {/* 4. UX MILLORADA: Tornar al MAPA, no a l'inici */}
          <Link
            href={`/learn/${slug}`}
            className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors group"
          >
            <div className="p-1.5 rounded-full bg-slate-800 group-hover:bg-slate-700 transition-colors">
              <ArrowLeft className="w-4 h-4" />
            </div>
            <span className="font-medium text-sm">Sortir del nivell</span>
          </Link>

          {/* Badge de Nivell */}
          <div className="px-3 py-1 bg-blue-500/10 border border-blue-500/20 text-blue-400 text-xs font-bold rounded-full uppercase tracking-wider">
            Tier {difficulty}
          </div>
        </div>
      </header>

      {/* ZONA DE JOC */}
      <div className="flex-1 flex flex-col items-center justify-center p-4 md:p-6 w-full max-w-5xl mx-auto">
        {!response.success ? (
          <div className="text-center max-w-md p-8 bg-slate-900 border border-red-900/50 rounded-2xl">
            <h1 className="text-xl font-bold text-red-400 mb-2">Error de c√†rrega</h1>
            <p className="text-slate-400 mb-6">{response.error}</p>
            <Link href={`/learn/${slug}`} className="px-6 py-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors">
              Tornar al Mapa
            </Link>
          </div>
        ) : !response.data || response.data.length === 0 ? (
          <div className="text-center py-10 animate-in fade-in zoom-in duration-500">
            <div className="text-6xl mb-4">üéâ</div>
            <h1 className="text-3xl font-black text-transparent bg-clip-text bg-linear-to-r from-yellow-400 to-orange-500 mb-4">
              Nivell Completat!
            </h1>
            <p className="text-xl text-slate-400 max-w-lg mx-auto mb-8">
              Ja has superat tots els reptes d'aquest nivell de dificultat.
            </p>
            <Link
              href={`/learn/${slug}`}
              className="inline-flex items-center px-8 py-4 bg-blue-600 rounded-xl font-bold text-white hover:bg-blue-500 hover:scale-105 transition-all shadow-lg shadow-blue-600/20"
            >
              Tornar al Mapa
            </Link>
          </div>
        ) : (
          // ‚úÖ AQU√ç EST√Ä EL CANVI: PASSEM EL SLUG
          <GameArena
            challenges={response.data}
            topicSlug={slug} // <--- CONNEXI√ì FINAL
          />
        )}
      </div>
    </main>
  );
}

// =================== FILE: src/app/[locale]/layout.tsx ===================

// filepath: src/app/[locale]/layout.tsx
import type { Metadata } from "next";
import { Nunito } from "next/font/google";
import { NextIntlClientProvider } from 'next-intl';
import { getMessages } from 'next-intl/server';
import { createClient } from '@/infrastructure/utils/supabase/server'; // Importem el client
import "../globals.css";

// Components de Navegaci√≥
import { MobileBottomBar } from "@/presentation/components/layout/MobileBottomBar";
import { DesktopNavbar } from "@/presentation/components/layout/DesktopNavbar";

const nunito = Nunito({ 
  subsets: ["latin"],
  weight: ["400", "700", "800", "900"],
  variable: "--font-nunito",
});

export const metadata: Metadata = {
  title: "EduTech",
  description: "Apr√®n tecnologia jugant",
};

export default async function LocaleLayout({
  children,
  params
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}) {
  const { locale } = await params;
  const messages = await getMessages();

  // 1. COMPROVACI√ì DE SESSI√ì AL SERVIDOR
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();
  const isLoggedIn = !!user; // true si hi ha usuari, false si no

  return (
    <html lang={locale}>
      <body className={`${nunito.variable} font-sans bg-slate-950 text-white antialiased pb-24 md:pb-0 md:pt-20`}>
        {/* pb-24: Padding inferior al m√≤bil perqu√® la barra no tapi contingut.
            md:pt-20: Padding superior a l'escriptori perqu√® la navbar no tapi contingut.
        */}

        <NextIntlClientProvider messages={messages}>
          
          {/* BARRA SUPERIOR (ESCRIPTORI) */}
          <DesktopNavbar isLoggedIn={isLoggedIn} />

          {/* CONTINGUT PRINCIPAL */}
          <main className="min-h-screen relative">
             {children}
          </main>

          {/* BARRA INFERIOR (M√íBIL) */}
          <MobileBottomBar isLoggedIn={isLoggedIn} />

        </NextIntlClientProvider>
      </body>
    </html>
  );
}

// =================== FILE: src/app/[locale]/page.tsx ===================

// ‚úÖ ARA (CORRECTE - Apuntant al teu fitxer v4):
import { Link } from '@/navigation';   // <-- AQUEST √âS EL CANVI CLAU
import { redirect } from 'next/navigation'; // El redirect aqu√≠ pot ser el natiu pq ja tenim el locale als params

import { createClient } from '@/infrastructure/utils/supabase/server';
import { ArrowRight, Code2, Terminal } from 'lucide-react';
import { getTranslations } from 'next-intl/server';

interface LandingPageProps {
  params: Promise<{ locale: string }>;
}

export default async function LandingPage({ params }: LandingPageProps) {
  // 1. OBTENIR LOCALE I TRADUCCIONS
  const { locale } = await params;
  const t = await getTranslations('landing');
  const supabase = await createClient();

  // 2. SI JA T√â SESSI√ì -> CAP AL DASHBOARD (AMB LOCALE CORRECTE!)
  const { data: { user } } = await supabase.auth.getUser();
  
  if (user) {
    redirect(`/${locale}/dashboard`);
  }

  return (
    <main className="flex min-h-screen flex-col bg-slate-950 text-white overflow-hidden relative">
      


      {/* Fons Decoratiu */}
      <div className="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
          <div className="absolute top-[-10%] left-[-10%] w-[500px] h-125 bg-blue-600/20 rounded-full blur-[100px]" />
          <div className="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-emerald-500/10 rounded-full blur-[100px]" />
      </div>

      {/* Contingut */}
      <div className="z-10 flex flex-col items-center justify-center min-h-screen px-4 text-center max-w-4xl mx-auto pt-20">
        
        {/* Badge */}
        <div className="mb-8 px-4 py-1.5 rounded-full border border-slate-700 bg-slate-900/50 backdrop-blur-sm text-sm text-slate-300 font-medium inline-flex items-center gap-2 animate-in fade-in slide-in-from-bottom-4 duration-700">
           <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse" />
           {t('badge')}
        </div>

        {/* T√≠tol Hero */}
        <h1 className="text-5xl md:text-7xl font-black mb-6 leading-tight tracking-tight animate-in fade-in slide-in-from-bottom-8 duration-700">
           {t('title_prefix')} <br/>
           <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-cyan-400 to-emerald-400">
             {t('title_highlight')}
           </span>
        </h1>

        <p className="text-lg md:text-xl text-slate-400 mb-10 max-w-2xl leading-relaxed animate-in fade-in slide-in-from-bottom-12 duration-700">
           {t('description')}
        </p>

        {/* Botons */}
        <div className="flex flex-col sm:flex-row gap-4 w-full sm:w-auto animate-in fade-in slide-in-from-bottom-16 duration-700">
           <Link 
             href="/login" 
             className="px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl transition-all hover:scale-105 active:scale-95 shadow-lg shadow-blue-500/25 flex items-center justify-center gap-2"
           >
             {t('cta_primary')} <ArrowRight className="w-5 h-5" />
           </Link>
           <Link 
             href="/about" 
             className="px-8 py-4 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-all border border-slate-700"
           >
             {t('cta_secondary')}
           </Link>
        </div>

        {/* Icones Flotants (Decoraci√≥) */}
        <div className="absolute top-1/4 left-10 md:left-20 opacity-20 rotate-[-12deg] animate-pulse pointer-events-none">
            <Code2 className="w-24 h-24" />
        </div>
        <div className="absolute bottom-1/4 right-10 md:right-20 opacity-20 rotate-[12deg] animate-pulse pointer-events-none">
            <Terminal className="w-24 h-24" />
        </div>
      </div>
    </main>
  );
}

// =================== FILE: src/application/dto/dashboard-topic.dto.ts ===================

// filepath: src/application/dto/dashboard-topic.dto.ts
import { Topic } from "@/core/entities/topic.entity";

export interface DashboardTopicDTO extends Topic {
  progressPercentage: number; // 0 a 100
  totalXpEarned: number;
  currentLevel: number;
  isLocked: boolean; // Per si volem bloquejar temes avan√ßats
}

// =================== FILE: src/application/dto/level-node.dto.ts ===================

// filepath: src/application/dto/level-node.dto.ts

import { ChallengeType } from '@/core/entities/challenge.entity';
export type LevelStatus = 'LOCKED' | 'ACTIVE' | 'COMPLETED';
export interface LevelNodeDTO {
  tier: number;
  status: LevelStatus;
  totalXp: number;
  label: string;
  // Nous camps visuals
  isCurrentPosition: boolean;
  predominantType: ChallengeType; 
}

// =================== FILE: src/application/dto/session-result.dto.ts ===================

// filepath: src/application/dto/session-result.dto.ts
export interface SessionResultDTO {
  xpEarned: number;
  newTotalXp: number;
  newLevel: number;
  leveledUp: boolean;
}

// =================== FILE: src/application/use-cases/auth/logout.use-case.test.ts ===================

// filepath: src/application/use-cases/auth/logout.use-case.test.ts
import { describe, it, expect, vi } from 'vitest';
import { LogoutUseCase } from './logout.use-case';
import { IAuthService } from '@/core/services/auth.service';

const mockAuthService = {
  login: vi.fn(),
  register: vi.fn(),
  logout: vi.fn(), // <--- Aix√≤ √©s el que provarem
  getUser: vi.fn(),
} as unknown as IAuthService;

describe('LogoutUseCase', () => {
  it('should call auth service to sign out', async () => {
    // ARRANGE
    const useCase = new LogoutUseCase(mockAuthService);

    // ACT
    await useCase.execute();

    // ASSERT
    expect(mockAuthService.logout).toHaveBeenCalled();
  });
});

// =================== FILE: src/application/use-cases/auth/logout.use-case.ts ===================

// filepath: src/application/use-cases/auth/logout.use-case.ts
import { IAuthService } from '@/core/services/auth.service';

export class LogoutUseCase {
  constructor(private readonly authService: IAuthService) {}

  async execute(): Promise<void> {
    await this.authService.logout();
  }
}

// =================== FILE: src/application/use-cases/challenges/get-next-challenge.use-case.test.ts ===================

// filepath: src/application/use-cases/challenges/get-next-challenge.use-case.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { GetNextChallengeUseCase } from './get-next-challenge.use-case';
import { ITopicRepository } from '@/core/repositories/topic.repository';
import { IChallengeRepository } from '@/core/repositories/challenge.repository';
import { Challenge, ChallengeType, QuizContent } from '@/core/entities/challenge.entity';
import { Topic } from '@/core/entities/topic.entity';

// Mocks
const mockTopicRepo = {
  findBySlug: vi.fn(),
} as unknown as ITopicRepository;

const mockChallengeRepo = {
  findNextForUser: vi.fn(),
} as unknown as IChallengeRepository;

describe('GetNextChallengeUseCase', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('should return challenges translated to the requested locale', async () => {
    // ARRANGE
    const locale = 'en';
    const topicSlug = 'react-basics';
    const userId = 'user-123';
    const topicId = 'topic-abc';

    // 1. Simulem que trobem el tema (AMB LA NOVA ESTRUCTURA CORRECTA)
    const mockTopic: Topic = {
      id: topicId,
      slug: topicSlug,
      // CORRECCI√ì: Usem les propietats de la teva interf√≠cie
      nameKey: 'topic.react.title', 
      iconName: 'brand-react',      
      colorTheme: 'bg-blue-500', 
      isActive: true,               
      createdAt: new Date(),
      updatedAt: new Date()
    };

    vi.mocked(mockTopicRepo.findBySlug).mockResolvedValue(mockTopic);

    // 2. Simulem que el repositori retorna reptes
    const mockChallenges: Challenge[] = [
      {
        id: 'c1',
        topicId: topicId,
        difficultyTier: 1,
        type: 'QUIZ' as ChallengeType,
        content: {
          question: 'Question in English',
          explanation: 'Explanation',
          correctOptionIndex: 0,
          options: [{ id: 'o1', text: 'Option 1' }]
        },
        createdAt: new Date()
      }
    ];

    vi.mocked(mockChallengeRepo.findNextForUser).mockResolvedValue(mockChallenges);

    const useCase = new GetNextChallengeUseCase(mockTopicRepo, mockChallengeRepo);

    // ACT
    const result = await useCase.execute(topicSlug, userId, locale);

    // ASSERT
    expect(mockTopicRepo.findBySlug).toHaveBeenCalledWith(topicSlug);
    expect(mockChallengeRepo.findNextForUser).toHaveBeenCalledWith(topicId, userId, locale);
    
    expect(result).toHaveLength(1);
    
    // Type narrowing per accedir a les propietats de QuizContent
    const content = result[0].content as QuizContent;
    expect(content.question).toBe('Question in English');
  });
});

// =================== FILE: src/application/use-cases/challenges/get-next-challenge.use-case.ts ===================

// filepath: src/application/use-cases/challenges/get-next-challenge.use-case.ts
import { ITopicRepository } from '@/core/repositories/topic.repository';
import { IChallengeRepository } from '@/core/repositories/challenge.repository';
import { Challenge } from '@/core/entities/challenge.entity';
import { TopicNotFoundError } from '@/core/errors/topic.errors';

export class GetNextChallengeUseCase {
  constructor(
    private readonly topicRepository: ITopicRepository,
    private readonly challengeRepository: IChallengeRepository
  ) {}

  // 1. AFEGIM 'difficulty' A LA SIGNATURA
  async execute(topicSlug: string, userId: string, locale: string, difficulty: number): Promise<Challenge[]> {
    const topic = await this.topicRepository.findBySlug(topicSlug);

    if (!topic) {
      throw new TopicNotFoundError(topicSlug);
    }

    // 2. PASSEM 'difficulty' AL REPOSITORI
    return this.challengeRepository.findNextForUser(topic.id, userId, locale, difficulty);
  }
}

// =================== FILE: src/application/use-cases/dashboard/get-user-dashboard.use-case.ts ===================

// filepath: src/application/use-cases/dashboard/get-user-dashboard.use-case.ts
import { ITopicRepository } from "@/core/repositories/topic.repository";
import { DashboardTopicDTO } from "@/application/dto/dashboard-topic.dto";
import { SupabaseClient } from "@supabase/supabase-js"; 

// Nota: Normalment injectariem un IUserProgressRepository, 
// per√≤ per agilitzar la demo farem la consulta de progr√©s aqu√≠ o passarem el client.
// Per Clean Arch estricta, hauries de crear IUserProgressRepository.

export class GetUserDashboardUseCase {
  constructor(private topicRepository: ITopicRepository) {}

  async execute(userId: string, locale: string, supabaseClient: SupabaseClient): Promise<DashboardTopicDTO[]> {
    // 1. Obtenir tots els temes actius (tradu√Øts)
    // Assumim que el teu repo ja suporta locale, si no, usa el que tinguis
    const topics = await this.topicRepository.findAllActive(); 

    // 2. Obtenir el progr√©s de l'usuari (Raw query a Supabase per velocitat)
    const { data: progressData } = await supabaseClient
        .from('user_progress')
        .select('topic_id, xp_earned')
        .eq('user_id', userId);

    // 3. Fusionar dades (Mapping)
    return topics.map(topic => {
        // Calculem XP total per aquest tema
        const topicProgress = progressData?.filter(p => p.topic_id === topic.id) || [];
        const totalXp = topicProgress.reduce((sum, p) => sum + (p.xp_earned || 0), 0);
        
        // C√†lcul simplificat de percentatge (Ex: 1000 XP = 100%)
        // M√©s endavant ho farem comptant reptes totals vs reptes fets
        const percentage = Math.min(100, (totalXp / 500) * 100); 

        return {
            ...topic,
            progressPercentage: Math.round(percentage),
            totalXpEarned: totalXp,
            currentLevel: Math.floor(totalXp / 100) + 1,
            isLocked: false // L√≤gica futura de bloqueig
        };
    });
  }
}

// =================== FILE: src/application/use-cases/gamification/complete-session.use-case.test.ts ===================

// filepath: src/application/use-cases/gamification/complete-session.use-case.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { CompleteSessionUseCase } from './complete-session.use-case';
import { IUserRepository, UserProfile } from '@/core/repositories/user.repository';

// Mock del Repositori
const mockUserRepo = {
  findById: vi.fn(),
  saveProgress: vi.fn(),
  updateXp: vi.fn(),
} as unknown as IUserRepository;

describe('CompleteSessionUseCase', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('should calculate XP, save progress and level up user', async () => {
    // ARRANGE (Preparem l'escenari)
    const userId = 'user-123';
    const challengeIds = ['c1', 'c2', 'c3']; // 3 reptes fets
    const topicId = 'topic-react';
    
    // Simulem un usuari que t√© 90 XP (i pujar√† de nivell aviat)
    const mockUser: UserProfile = { 
      id: userId, 
      totalXp: 90, 
      level: 1 
    };

    vi.mocked(mockUserRepo.findById).mockResolvedValue(mockUser);

    const useCase = new CompleteSessionUseCase(mockUserRepo);

    // ACT (Executem)
    const result = await useCase.execute(userId, challengeIds, topicId);

    // ASSERT (Verifiquem)
    
    // 1. Ha de guanyar 30 XP (3 reptes * 10 XP)
    expect(result.xpEarned).toBe(30);
    
    // 2. XP Total: 90 + 30 = 120
    expect(result.newTotalXp).toBe(120);
    
    // 3. Com que supera els 100 XP, ha de ser Nivell 2
    expect(result.newLevel).toBe(2); 
    expect(result.leveledUp).toBe(true);

    // 4. Verifiquem que s'ha cridat al repositori per guardar
    expect(mockUserRepo.saveProgress).toHaveBeenCalledWith(userId, challengeIds, topicId, 10);
    expect(mockUserRepo.updateXp).toHaveBeenCalledWith(userId, 120, 2);
  });
});

// =================== FILE: src/application/use-cases/gamification/complete-session.use-case.ts ===================

// filepath: src/application/use-cases/gamification/complete-session.use-case.ts
import { IUserRepository } from '@/core/repositories/user.repository';
import { LevelCalculatorService } from '@/core/services/level-calculator.service';

export interface SessionResult {
  xpEarned: number;
  newTotalXp: number;
  newLevel: number;
  leveledUp: boolean;
}

export class CompleteSessionUseCase {
  private levelService = new LevelCalculatorService();

  constructor(private readonly userRepository: IUserRepository) {}

  async execute(userId: string, challengeIds: string[], topicId: string): Promise<SessionResult> {
    const XP_PER_CHALLENGE = 10;
    const totalXpEarned = challengeIds.length * XP_PER_CHALLENGE;

    // 1. Obtenim estat actual
    const userProfile = await this.userRepository.findById(userId);
    
    if (!userProfile) {
      throw new Error(`User ${userId} not found`);
    }

    // 2. Guardem el progr√©s detallat
    await this.userRepository.saveProgress(userId, challengeIds, topicId, XP_PER_CHALLENGE);

    // 3. Calculem nous valors
    const oldLevel = userProfile.level;
    const newTotalXp = userProfile.totalXp + totalXpEarned;
    const newLevel = this.levelService.calculateLevel(newTotalXp);

    // 4. Actualitzem el perfil si ha canviat alguna cosa
    if (newTotalXp !== userProfile.totalXp) {
        await this.userRepository.updateXp(userId, newTotalXp, newLevel);
    }

    return {
      xpEarned: totalXpEarned,
      newTotalXp,
      newLevel,
      leveledUp: newLevel > oldLevel
    };
  }
}

// =================== FILE: src/application/use-cases/topics/get-active-topics.use-case.test.ts ===================

// filepath: src/application/use-cases/topics/get-active-topics.use-case.test.ts
import { describe, it, expect, vi } from 'vitest';
import { GetActiveTopicsUseCase } from './get-active-topics.use-case';
import { ITopicRepository } from '@/core/repositories/topic.repository';
import { Topic } from '@/core/entities/topic.entity';

// 1. Creem un Mock del Repositori
const mockTopicRepo = {
  findAllActive: vi.fn(),
  findAll: vi.fn(),
  findById: vi.fn(),
  findBySlug: vi.fn(),
  create: vi.fn(),
  update: vi.fn(),
} as unknown as ITopicRepository;

describe('GetActiveTopicsUseCase', () => {
  it('should return a list of active topics', async () => {
    // ARRANGE (Preparar)
    const mockTopics: Topic[] = [
      { 
        id: '123', 
        slug: 'react', 
        nameKey: 'topic.react', 
        iconName: 'react', 
        colorTheme: 'blue', 
        isActive: true, 
        createdAt: new Date(), 
        updatedAt: new Date() 
      }
    ];
    
    // Configurem el mock per retornar les dades falses
    vi.mocked(mockTopicRepo.findAllActive).mockResolvedValue(mockTopics);

    const useCase = new GetActiveTopicsUseCase(mockTopicRepo);

    // ACT (Executar)
    const result = await useCase.execute();

    // ASSERT (Verificar)
    expect(result).toHaveLength(1);
    expect(result[0].slug).toBe('react');
    expect(mockTopicRepo.findAllActive).toHaveBeenCalledTimes(1);
  });

  it('should return empty list if no topics found', async () => {
    vi.mocked(mockTopicRepo.findAllActive).mockResolvedValue([]);
    const useCase = new GetActiveTopicsUseCase(mockTopicRepo);
    
    const result = await useCase.execute();
    
    expect(result).toEqual([]);
  });
});

// =================== FILE: src/application/use-cases/topics/get-active-topics.use-case.ts ===================

// filepath: src/application/use-cases/topics/get-active-topics.use-case.ts
import { ITopicRepository } from '@/core/repositories/topic.repository';
import { Topic } from '@/core/entities/topic.entity';

/**
 * Cas d'√ös: Obtenir el llistat de temes disponibles per als usuaris.
 * Nom√©s retorna els que tenen isActive: true.
 */
export class GetActiveTopicsUseCase {
  // Injectem la interf√≠cie, no la implementaci√≥ de Supabase!
  constructor(private readonly topicRepository: ITopicRepository) {}

  async execute(): Promise<Topic[]> {
    return this.topicRepository.findAllActive();
  }
}

// =================== FILE: src/application/use-cases/topics/get-topic-path.use-case.ts ===================

// filepath: src/application/use-cases/topics/get-topic-path.use-case.ts
import { ITopicRepository } from '@/core/repositories/topic.repository';
import { LevelNodeDTO, LevelStatus } from '@/application/dto/level-node.dto';

export class GetTopicPathUseCase {

  constructor(private topicRepo: ITopicRepository) { }

  async execute(userId: string, topicId: string) {
    const stats = await this.topicRepo.getTopicProgressSummary(topicId, userId);
    const levels: LevelNodeDTO[] = [];

    // Cas buit
    if (stats.length === 0) {
      return {
        levels: [{
          tier: 1,
          status: 'ACTIVE' as LevelStatus,
          label: 'Inici',
          totalXp: 0,
          isCurrentPosition: true,
          predominantType: 'QUIZ', 
        }],
        totalXp: 0
      };
    }

    let isPreviousLevelCompleted = true;

    for (let i = 0; i < stats.length; i++) {
      const stat = stats[i];
      let status: LevelStatus = 'LOCKED';

      const isCompleted = stat.completedChallenges >= stat.totalChallenges && stat.totalChallenges > 0;

      if (isCompleted) {
        status = 'COMPLETED';
      } else if (isPreviousLevelCompleted) {
        status = 'ACTIVE';
        isPreviousLevelCompleted = false;
      } else {
        status = 'LOCKED';
      }

      const isCurrentPosition = status === 'ACTIVE' || (status === 'COMPLETED' && !stats[i + 1]);

      levels.push({
        tier: stat.tier,
        status,
        label: this.getLevelLabel(stat.tier),
        totalXp: stat.completedChallenges,
        isCurrentPosition: isCurrentPosition, 
        
        // ‚úÖ CORRECCI√ì 1: Dins del bucle, usem la dada real de la BD
        predominantType: stat.mostCommonType 
      });

      if (status === 'COMPLETED') {
        isPreviousLevelCompleted = true;
      }
    }

    // Nivell Extra (Infinit)
    const lastLevel = levels[levels.length - 1];
    if (lastLevel && lastLevel.status === 'COMPLETED') {
      levels.push({
        tier: lastLevel.tier + 1,
        status: 'ACTIVE' as LevelStatus,
        label: '???',
        totalXp: 0,
        isCurrentPosition: true,
        
        // ‚úÖ CORRECCI√ì 2: Fora del bucle, 'stat' no existeix. 
        // Posem 'QUIZ' per defecte al nivell futur.
        predominantType: 'QUIZ' 
      });
    }

    const totalXp = levels.reduce((acc, curr) => acc + curr.totalXp, 0);
    return { levels, totalXp };
  }

  private getLevelLabel(tier: number): string {
    const labels = ["Fonaments", "Conceptes Clau", "Pr√†ctica", "Avan√ßat", "Expert", "Mestre", "Llegenda"];
    return labels[tier - 1] || `Secci√≥ ${tier}`;
  }
}

// =================== FILE: src/core/entities/challenge.entitiy.test.ts ===================

// filepath: src/core/entities/challenge.entity.test.ts
import { describe, it, expect } from 'vitest';
// 1. IMPORT CORRECTE
import { Challenge, CodeFixContent } from './challenge.entity'; 

describe('Challenge Entity Polymorphism', () => {
  
  it('should correctly type a CODE_FIX challenge', () => {
    // Arrange
    const codeChallenge: Challenge = {
      id: '1',
      topicId: 'react',
      difficultyTier: 1,
      type: 'CODE_FIX',
      createdAt: new Date(),
      content: {
        description: 'Completa el hook', // 2. Nom Correcte
        initialCode: 'const [val, setVal] = ___(0);', // 3. Nom Correcte
        solution: 'useState', // 4. Nom Correcte
        tests: []
      } as CodeFixContent
    };

    // Act & Assert
    if (codeChallenge.type === 'CODE_FIX') {
        const content = codeChallenge.content as CodeFixContent;
        expect(content.initialCode).toContain('___'); // 5. Nom Correcte
        expect(content.solution).toBe('useState');
    } else {
        throw new Error('Type guard failed');
    }
  });
});

// =================== FILE: src/core/entities/challenge.entity.ts ===================

// filepath: src/core/entities/challenge.entity.ts

// 1. Definim tots els tipus de joc que suportar√† el sistema
export type ChallengeType = 'QUIZ' | 'CODE_FIX' | 'MATCHING' | 'TERMINAL';

// --- COMPONENTS REUTILITZABLES ---

export interface ChallengeOption {
  id: string;
  text: string;
}

// --- CONTINGUTS ESPEC√çFICS PER A CADA JOC ---

// A. Tipus Test (El que ja tens)
export interface QuizContent {
  question: string;
  explanation: string;
  options: ChallengeOption[]; 
  correctOptionIndex: number;
}
export interface CodeFixOption {
  id: string;
  code: string;     // El text que es mostrar√† a la carta (ex: "useState")
  isCorrect: boolean;
}
// B. Tipus "Arregla el Codi" (El teu, molt potent)
export interface CodeFixContent {
  description: string;
  initialCode: string;
  solution: string; // La soluci√≥ correcta (per validar o mostrar)
  hint: string; // üëà Cambiat de 'hints?: string[]' a 'hint: string'
  tests: { input: string; output: string }[]; // Casos de prova per validar l'execuci√≥
  options: CodeFixOption[]; // Les 3 opcions
}

// C. Tipus "Relacionar Conceptes" (Nou requisit: sin√≤nims, conceptes)
export interface MatchingContent {
  instruction: string; // Ex: "Relaciona cada hook amb la seva funci√≥"
  pairs: { 
    left: ChallengeOption; 
    right: ChallengeOption 
  }[];
}

// --- UNION TYPE (POLIMORFISME) ---
// Aix√≤ permet que TypeScript s√†piga autom√†ticament quins camps tens
// si comproves el 'type'.
export type ChallengeContent = 
  | QuizContent 
  | CodeFixContent 
  | MatchingContent;
  // | TerminalContent (Futur)

// --- ENTITAT PRINCIPAL ---
export interface Challenge {
  id: string;
  topicId: string;
  difficultyTier: number;
  type: ChallengeType;       // El discriminador
  content: ChallengeContent; // Contingut din√†mic
  createdAt: Date;
}

// =================== FILE: src/core/entities/topic.entity.ts ===================

// filepath: src/core/entities/topic.entity.ts

/**
 * Representa una categoria o √†rea d'aprenentatge dins del sistema.
 * Aquesta entitat √©s agn√≤stica a la base de dades.
 */
export interface Topic {
  id: string;              // UUID
  slug: string;            // URL friendly ID (ex: 'react-basics')
  nameKey: string;         // Clau de traducci√≥ i18n (ex: 'topic.react.title')
  iconName: string;        // Identificador de la icona (ex: 'brand-react')
  colorTheme: string;      // Classe CSS o Hex (ex: 'bg-blue-500')
  parentTopicId?: string;  // Opcional: Per a jerarquies
  isActive: boolean;       // Per a soft-deletes i control de visibilitat
  description: string,
  // Metadades d'auditoria (opcionals al domini pur, per√≤ √∫tils)
  createdAt: Date;
  updatedAt: Date;
}

/**
 * Tipus per a la creaci√≥ d'un nou tema (sense ID ni dates)
 */
export type CreateTopicInput = Omit<Topic, 'id' | 'createdAt' | 'updatedAt'>;

// =================== FILE: src/core/errors/domain-error.ts ===================

// filepath: src/core/errors/domain-error.ts
export abstract class DomainError extends Error {
  constructor(message: string) {
    super(message);
    this.name = this.constructor.name;
    Object.setPrototypeOf(this, new.target.prototype);
  }
}

// =================== FILE: src/core/errors/topic.errors.ts ===================

// filepath: src/core/errors/topic.errors.ts
import { DomainError } from './domain-error';

export class TopicNotFoundError extends DomainError {
  constructor(identifier: string) {
    super(`El tema amb identificador '${identifier}' no s'ha trobat.`);
  }
}

export class TopicAlreadyExistsError extends DomainError {
  constructor(slug: string) {
    super(`Ja existeix un tema amb l'slug '${slug}'.`);
  }
}

// =================== FILE: src/core/errors/user-not-found.error.ts ===================

// filepath: src/core/errors/user-not-found.error.ts
export class UserNotFoundError extends Error {
  constructor(userId: string) {
    super(`User with ID ${userId} could not be found.`);
    this.name = 'UserNotFoundError';
  }
}

// =================== FILE: src/core/repositories/challenge.repository.ts ===================

// filepath: src/core/repositories/challenge.repository.ts
import { Challenge } from '../entities/challenge.entity';

export interface IChallengeRepository {
  /**
   * Obt√© el seg√ºent repte per a un usuari en un tema,
   * tradu√Øt a l'idioma especificat.
   */
  findNextForUser(topicId: string, userId: string, locale: string, difficulty: number): Promise<Challenge[]>;

  // (Opcional) Si necessites aquests altres m√®todes, tamb√© han de rebre locale
  findByTopicId(topicId: string, locale: string): Promise<Challenge[]>;
  findById(id: string, locale: string): Promise<Challenge | null>;
}

// =================== FILE: src/core/repositories/topic.repository.ts ===================

// filepath: src/core/repositories/topic.repository.ts
import { Topic, CreateTopicInput } from '../entities/topic.entity';
import { ChallengeType } from '../entities/challenge.entity'; // Importa el tipus
export interface TierProgressStats {
  tier: number;
  totalChallenges: number;
  completedChallenges: number;
  mostCommonType: ChallengeType; // <--- NOU CAMP
}
/**
 * Contracte que qualsevol adaptador de persist√®ncia (Infrastructure) ha de complir.
 * Retorna Promises perqu√® l'I/O √©s as√≠ncron, per√≤ retorna entitats de Domini.
 */
export interface ITopicRepository {
  /**
   * Obt√© tots els temes actius.
   */
  findAllActive(): Promise<Topic[]>;

  /**
   * Obt√© tots els temes (inclosos els inactius) - √ötil per a Admin.
   */
  findAll(): Promise<Topic[]>;

  /**
   * Cerca un tema pel seu ID.
   * @returns El tema o null si no existeix.
   */
  findById(id: string): Promise<Topic | null>;

  /**
   * Cerca un tema pel seu slug (per a rutes p√∫bliques).
   * @returns El tema o null si no existeix.
   */
  findBySlug(slug: string): Promise<Topic | null>;

  /**
   * Crea un nou tema.
   */
  create(topic: CreateTopicInput): Promise<Topic>;
  
  /**
   * Actualitza un tema existent.
   */
  update(id: string, topic: Partial<CreateTopicInput>): Promise<Topic>;

  getTopicProgressSummary(topicId: string, userId: string): Promise<TierProgressStats[]>;
}

// =================== FILE: src/core/repositories/user.repository.ts ===================

// filepath: src/core/repositories/user.repository.ts
export interface UserProfile {
  id: string;
  totalXp: number;
  level: number;
}

export interface IUserRepository {
  findById(userId: string): Promise<UserProfile | null>;
  saveProgress(userId: string, challengeIds: string[], topicId: string, xpPerChallenge: number): Promise<void>;
  updateXp(userId: string, newXp: number, newLevel: number): Promise<void>;
}

// =================== FILE: src/core/services/auth.service.ts ===================

// filepath: src/core/services/auth.service.ts
export interface UserIdentity {
  id: string;
  email: string;
}

export interface IAuthService {
  logout(): Promise<void>;
  getUser(): Promise<UserIdentity | null>;
  // Login i Register els gestiona Supabase directament via Actions, 
  // per√≤ el Logout √©s millor passar-lo per aqu√≠ per neteja.
}

// =================== FILE: src/core/services/level-calculator.service.ts ===================

// filepath: src/core/services/level-calculator.service.ts
export class LevelCalculatorService {
  /**
   * F√≥rmula simple: Nivell = (TotalXP / 100) + 1
   * 0-99 XP -> Nivell 1
   * 100-199 XP -> Nivell 2
   */
  calculateLevel(totalXp: number): number {
    if (totalXp < 0) return 1;
    return Math.floor(totalXp / 100) + 1;
  }

  /**
   * Calcula el % de progr√©s cap al seg√ºent nivell.
   */
  calculateProgressToNextLevel(totalXp: number): number {
    const currentLevel = this.calculateLevel(totalXp);
    const xpForCurrentLevel = (currentLevel - 1) * 100;
    const xpInCurrentLevel = totalXp - xpForCurrentLevel;
    
    return Math.min(100, Math.max(0, xpInCurrentLevel));
  }
}

// =================== FILE: src/i18n.ts ===================

// filepath: src/i18n.ts
import { notFound } from 'next/navigation';
import { getRequestConfig } from 'next-intl/server';
import { routing, type Locale } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  const locale = await requestLocale;

  // Validaci√≥ sense 'any':
  // Convertim routing.locales a llista d'strings gen√®rics per comprovar
  if (!locale || !(routing.locales as readonly string[]).includes(locale)) {
    notFound(); // Ara s√≠ que l'executem si la validaci√≥ falla
  }

  return {
    // Aqu√≠ ja estem segurs que 'locale' √©s v√†lid, podem fer el cast segur a Locale
    locale: locale as Locale,
    messages: (await import(`../messages/${locale}.ts`)).default
  };
});

// =================== FILE: src/infrastructure/repositories/supabase/challenge.repository.test.ts ===================

// filepath: src/infrastructure/repositories/supabase/challenge.repository.real.test.ts

// --- 1. CARREGAR VARIABLES D'ENTORN MANUALMENT ---
import { config } from 'dotenv';
config({ path: '.env.test' });

import { describe, it, expect, beforeEach, beforeAll, vi } from 'vitest';
// Importem el client 'vanilla' de la llibreria oficial (el que no usa cookies)
import { createClient as createVanillaClient } from '@supabase/supabase-js'; 
import { SupabaseChallengeRepository } from './challenge.repository';
import { QuizContent } from '@/core/entities/challenge.entity';

// --- CONSTANTS ---
const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;
const SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;


const shouldRun = SUPABASE_URL && SERVICE_ROLE_KEY;

// --- 2. MOCK DEL CONTEXT DE NEXT.JS (La soluci√≥ a l'error de cookies) ---
// Interceptem la importaci√≥ de 'utils/supabase/server'.
// En lloc d'usar cookies(), retornem un client est√†ndard connectat a local.
vi.mock('@/infrastructure/utils/supabase/server', () => {
  return {
    createClient: async () => {
      // Retornem un client REAL, per√≤ creat de forma "tonta" (sense cookies).
      // Usem la clau SERVICE_ROLE per evitar problemes d'autenticaci√≥ en el test d'integraci√≥,
      // ja que en aquest test volem validar SQL i Mapeig, no Auth.
      if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.SUPABASE_SERVICE_ROLE_KEY) {
        throw new Error("Falten variables d'entorn al Mock");
      }
      return createVanillaClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL,
        process.env.SUPABASE_SERVICE_ROLE_KEY,
        { auth: { persistSession: false } }
      );
    }
  };
});

describe('SupabaseChallengeRepository (REAL DB INTEGRATION)', () => {
  if (!shouldRun) {
    it.skip('Skipping integration tests: Missing keys', () => {});
    return;
  }

  // Client ADMIN per preparar l'escenari
  const adminClient = createVanillaClient(SUPABASE_URL!, SERVICE_ROLE_KEY!, {
    auth: { persistSession: false, autoRefreshToken: false }
  });

  let repository: SupabaseChallengeRepository;
  
  const TEST_TOPIC_ID = '11111111-1111-1111-1111-111111111111';
  const TEST_CHALLENGE_ID = '22222222-2222-2222-2222-222222222222';
  const TEST_USER_ID = '33333333-3333-3333-3333-333333333333';

  beforeAll(async () => {
    // Setup Topic
    await adminClient.from('topics').upsert({
      id: TEST_TOPIC_ID,
      slug: 'integration-test-topic',
      name_key: 'topic.test',
      icon_name: 'test-icon',
      color_theme: 'bg-test',
      active: true
    });
  });

  beforeEach(async () => {
    // Inicialitzem el repo (que ara usar√† el nostre Mock internament)
    repository = new SupabaseChallengeRepository();
    // Neteja
    await adminClient.from('challenges').delete().eq('id', TEST_CHALLENGE_ID);
  });

  it('should store and retrieve a localized JSONB challenge correctly', async () => {
    // ARRANGE: Inserim dades REALS
    const { error: insertError } = await adminClient.from('challenges').insert({
      id: TEST_CHALLENGE_ID,
      topic_id: TEST_TOPIC_ID,
      difficulty_tier: 1,
      type: 'QUIZ',
      content: {
        question: { ca: "Hola M√≥n", en: "Hello World" },
        explanation: { ca: "Prova", en: "Test" },
        correctOptionIndex: 0,
        options: [
          { id: "opt1", text: { ca: "Opci√≥ A", en: "Option A" } }
        ]
      }
    });

    if (insertError) throw new Error(`Insert failed: ${insertError.message}`);

    // ACT: El Repositori fa la consulta REAL a Postgres
    const result = await repository.findNextForUser(TEST_TOPIC_ID, TEST_USER_ID, 'ca');

    // ASSERT
    expect(result).toHaveLength(1);
    const content = result[0].content as QuizContent;
    
    // Si aix√≤ passa, vol dir que hem llegit JSONB real de la BD
    expect(content.question).toBe("Hola M√≥n"); 
    expect(content.options[0].text).toBe("Opci√≥ A");
  });
});

// =================== FILE: src/infrastructure/repositories/supabase/challenge.repository.ts ===================

// filepath: src/infrastructure/repositories/supabase/challenge.repository.ts
import { createClient } from '@/infrastructure/utils/supabase/server';
import { IChallengeRepository } from '@/core/repositories/challenge.repository';
import { Challenge, ChallengeType, ChallengeContent } from '@/core/entities/challenge.entity';

// --- 1. DEFINICI√ì DE TIPUS DE LA BASE DE DADES (RAW JSON) ---

type LocalizedString = Record<string, string>;

// Estructura JSON per a MATCHING a la BD
type RawMatchingContent = {
  instruction: LocalizedString;
  pairs: Array<{
    left: { id: string; text: LocalizedString };
    right: { id: string; text: LocalizedString };
  }>;
};

// Estructura JSON per a CODE_FIX a la BD
type RawCodeFixContent = {
  description: LocalizedString;
  initialCode: string;
  solution: string;
  tests?: Array<{ input: string; output: string }>;
  hint: LocalizedString; // <--- NOU
  options: Array<{       // <--- NOU
    id: string;
    code: string;
    isCorrect: boolean
  }>;
};

// Estructura JSON per a QUIZ a la BD (Format Nou)
type RawQuizContent = {
  question: LocalizedString;
  explanation: LocalizedString;
  options: Array<{ id: string; text: LocalizedString }>;
  correctOptionIndex: number;
};

// Estructura JSON per a QUIZ a la BD (Legacy / Fallback)
type LegacyRawContent = {
  question?: string;
  explanation?: string;
  options?: string[];
  correctOptionIndex?: number;
};

// Tipus de la fila SQL (content √©s unknown fins que el validem)
type ChallengeRow = {
  id: string;
  topic_id: string;
  difficulty_tier: number;
  type: string;
  content: unknown;
  created_at: string;
};

export class SupabaseChallengeRepository implements IChallengeRepository {

  // --- PRIVATE HELPERS ---

  private translate(field: LocalizedString | string | unknown, locale: string): string {
    if (typeof field === 'string') return field;
    if (!field || typeof field !== 'object') return '';

    const localized = field as LocalizedString;
    return localized[locale] || localized['ca'] || localized['en'] || Object.values(localized)[0] || '';
  }

  private mapToEntity(row: ChallengeRow, locale: string): Challenge {
    const challengeType = row.type as ChallengeType;

    // 1. Processar el JSON (pot venir com string o objecte)
    let rawData = row.content;
    if (typeof rawData === 'string') {
      try {
        rawData = JSON.parse(rawData);
      } catch (e) {
        console.error(`Error parsing JSON for challenge ${row.id}`, e);
        rawData = {};
      }
    }

    let localizedContent: ChallengeContent;

    // --- LOGICA POLIM√íRFICA STRICTA (SENSE ANY) ---
    switch (challengeType) {

      // CAS 1: MATCHING
      case 'MATCHING': {
        // Fem un cast al tipus RAW espec√≠fic
        const content = rawData as RawMatchingContent;

        localizedContent = {
          instruction: this.translate(content.instruction, locale),
          pairs: Array.isArray(content.pairs)
            ? content.pairs.map(p => ({
              left: {
                id: p.left.id,
                text: this.translate(p.left.text, locale)
              },
              right: {
                id: p.right.id,
                text: this.translate(p.right.text, locale)
              }
            }))
            : []
        };
        break;
      }

      // CAS 2: CODE_FIX
      case 'CODE_FIX': {
        const content = rawData as RawCodeFixContent;

        localizedContent = {
          description: this.translate(content.description, locale),
          initialCode: content.initialCode || '',
          solution: content.solution || '',
          // ‚úÖ Assignem la traducci√≥ a 'hint' (singular)
          hint: this.translate(content.hint, locale),
          tests: content.tests || [],
          options: Array.isArray(content.options) ? content.options.map(opt => ({
            id: opt.id,
            code: opt.code,
            isCorrect: opt.isCorrect
          })) : []
        };
        break;
      }

      // CAS 3: QUIZ
      case 'QUIZ':
      default: {
        // Type Guard per detectar format nou
        const quizObj = rawData as Partial<RawQuizContent>;
        const isNewFormat =
          quizObj &&
          'options' in quizObj &&
          Array.isArray(quizObj.options) &&
          quizObj.options.length > 0 &&
          typeof quizObj.options[0] === 'object';

        if (isNewFormat) {
          const content = rawData as RawQuizContent;
          localizedContent = {
            question: this.translate(content.question, locale),
            explanation: this.translate(content.explanation, locale),
            correctOptionIndex: content.correctOptionIndex,
            options: content.options.map(opt => ({
              id: opt.id,
              text: this.translate(opt.text, locale)
            }))
          };
        } else {
          // Legacy
          const content = rawData as LegacyRawContent;
          const oldOptions = Array.isArray(content.options) ? content.options : [];
          localizedContent = {
            question: String(content.question || ''),
            explanation: String(content.explanation || ''),
            correctOptionIndex: content.correctOptionIndex || 0,
            options: oldOptions.map((txt, idx) => ({
              id: `opt-${idx}`,
              text: String(txt)
            }))
          };
        }
        break;
      }
    }

    return {
      id: row.id,
      topicId: row.topic_id,
      difficultyTier: row.difficulty_tier,
      type: challengeType,
      content: localizedContent,
      createdAt: new Date(row.created_at),
    };
  }

  // --- PUBLIC METHODS ---

  async findNextForUser(topicId: string, userId: string, locale: string, difficulty: number): Promise<Challenge[]> {
    const supabase = await createClient();

    const { data: completed } = await supabase
      .from('user_progress')
      .select('challenge_id')
      .eq('user_id', userId)
      .eq('topic_id', topicId);

    const completedIds = completed?.map(c => c.challenge_id) || [];

    let query = supabase
      .from('challenges')
      .select('*')
      .eq('topic_id', topicId)
      .eq('difficulty_tier', difficulty);

    if (completedIds.length > 0) {
      query = query.filter('id', 'not.in', `(${completedIds.join(',')})`);
    }

    const { data: newChallenges } = await query.limit(10);

    if (newChallenges && newChallenges.length > 0) {
      return newChallenges.map(row => this.mapToEntity(row as ChallengeRow, locale));
    }

    // Fallback Mode Rep√†s
    const { data: reviewChallenges } = await supabase
      .from('challenges')
      .select('*')
      .eq('topic_id', topicId)
      .eq('difficulty_tier', difficulty)
      .limit(10);

    return (reviewChallenges || []).map(row => this.mapToEntity(row as ChallengeRow, locale));
  }

  async findByTopicId(topicId: string, locale: string = 'ca'): Promise<Challenge[]> {
    const supabase = await createClient();
    const { data, error } = await supabase
      .from('challenges')
      .select('*')
      .eq('topic_id', topicId);

    if (error) throw new Error(error.message);
    return data.map((row) => this.mapToEntity(row as ChallengeRow, locale));
  }

  async findById(id: string, locale: string = 'ca'): Promise<Challenge | null> {
    const supabase = await createClient();
    const { data, error } = await supabase
      .from('challenges')
      .select('*')
      .eq('id', id)
      .single();

    if (error) {
      if (error.code === 'PGRST116') return null;
      throw new Error(error.message);
    }
    return this.mapToEntity(data as ChallengeRow, locale);
  }
}

// =================== FILE: src/infrastructure/repositories/supabase/topic.repository.ts ===================

// filepath: src/infrastructure/repositories/supabase/topic.repository.ts

import { ITopicRepository, TierProgressStats } from '@/core/repositories/topic.repository';
import { Topic, CreateTopicInput } from '@/core/entities/topic.entity';
import { TopicNotFoundError } from '@/core/errors/topic.errors';
import { createClient } from '@/infrastructure/utils/supabase/server'; // El teu helper
import { ChallengeType } from '@/core/entities/challenge.entity';
// 1. Definim el tipus exacte de la fila a la BD (Lectura)
type TopicRow = {
  id: string;
  slug: string;
  name_key: string;
  icon_name: string;
  color_theme: string;
  parent_topic_id: string | null;
  is_active: boolean;
  created_at: string;
  updated_at: string;
  description?: string;
};

// 2. Definim el tipus per a Escriptura (Insert/Update)
type TopicPersistencePayload = {
  slug?: string;
  name_key?: string;
  icon_name?: string;
  color_theme?: string;
  parent_topic_id?: string | null;
  is_active?: boolean;
};

export class SupabaseTopicRepository implements ITopicRepository {

  // ‚ùå ESBORRAT: No podem tenir una propietat 'supabase' aqu√≠ perqu√® el client √©s async.
  // private supabase = ...

  private mapToEntity(row: TopicRow): Topic {
    return {
      id: row.id,
      slug: row.slug,
      nameKey: row.name_key,
      iconName: row.icon_name,
      colorTheme: row.color_theme,
      parentTopicId: row.parent_topic_id || undefined,
      isActive: row.is_active,
      createdAt: new Date(row.created_at),
      updatedAt: new Date(row.updated_at),
      description: row.description || ''
    };
  }

  async findAllActive(): Promise<Topic[]> {
    // ‚úÖ CORRECCI√ì: Instanciem el client DINS del m√®tode
    const supabase = await createClient();

    const { data, error } = await supabase
      .from('topics')
      .select('*')
      .eq('is_active', true)
      .returns<TopicRow[]>();

    if (error) throw new Error(`Supabase Error: ${error.message}`);

    return data.map((row) => this.mapToEntity(row));
  }

  async findAll(): Promise<Topic[]> {
    const supabase = await createClient(); // ‚úÖ Instancia local

    const { data, error } = await supabase
      .from('topics')
      .select('*')
      .returns<TopicRow[]>();

    if (error) throw new Error(error.message);
    return data.map((row) => this.mapToEntity(row));
  }

  async findById(id: string): Promise<Topic | null> {
    const supabase = await createClient(); // ‚úÖ Instancia local

    const { data, error } = await supabase
      .from('topics')
      .select('*')
      .eq('id', id)
      .single<TopicRow>();

    if (error) {
      if (error.code === 'PGRST116') return null;
      throw new Error(error.message);
    }

    return this.mapToEntity(data);
  }

  async findBySlug(slug: string): Promise<Topic | null> {
    const supabase = await createClient(); // ‚úÖ Instancia local

    const { data, error } = await supabase
      .from('topics')
      .select('*')
      .eq('slug', slug)
      .single<TopicRow>();

    if (error) {
      if (error.code === 'PGRST116') return null;
      throw new Error(error.message);
    }

    return this.mapToEntity(data);
  }

  async create(input: CreateTopicInput): Promise<Topic> {
    const supabase = await createClient(); // ‚úÖ Instancia local

    const dbPayload: TopicPersistencePayload = {
      slug: input.slug,
      name_key: input.nameKey,
      icon_name: input.iconName,
      color_theme: input.colorTheme,
      parent_topic_id: input.parentTopicId || null,
      is_active: input.isActive
    };

    const { data, error } = await supabase
      .from('topics')
      .insert(dbPayload)
      .select()
      .single<TopicRow>();

    if (error) throw new Error(error.message);
    return this.mapToEntity(data);
  }

  async update(id: string, input: Partial<CreateTopicInput>): Promise<Topic> {
    const supabase = await createClient(); // ‚úÖ Instancia local

    const dbPayload: TopicPersistencePayload = {};

    if (input.slug !== undefined) dbPayload.slug = input.slug;
    if (input.nameKey !== undefined) dbPayload.name_key = input.nameKey;
    if (input.iconName !== undefined) dbPayload.icon_name = input.iconName;
    if (input.colorTheme !== undefined) dbPayload.color_theme = input.colorTheme;
    if (input.isActive !== undefined) dbPayload.is_active = input.isActive;
    if (input.parentTopicId !== undefined) dbPayload.parent_topic_id = input.parentTopicId;

    const { data, error } = await supabase
      .from('topics')
      .update(dbPayload)
      .eq('id', id)
      .select()
      .single<TopicRow>();

    if (error) {
      if (error.code === 'PGRST116') {
        throw new TopicNotFoundError(id);
      }
      throw new Error(error.message);
    }

    return this.mapToEntity(data);
  }

  async getTopicProgressSummary(topicId: string, userId: string): Promise<TierProgressStats[]> {
    const supabase = await createClient();

    // 1. Obtenir reptes amb el seu TIPUS
    const { data: challenges, error: chalError } = await supabase
      .from('challenges')
      .select('id, difficulty_tier, type') // <--- AFEGIM 'type'
      .eq('topic_id', topicId);

    if (chalError) throw new Error(chalError.message);
    if (!challenges) return [];

    // 2. Obtenir el progr√©s de l'usuari en aquest tema
    const { data: progress, error: progError } = await supabase
      .from('user_progress')
      .select('challenge_id')
      .eq('user_id', userId)
      .eq('topic_id', topicId);

    if (progError) throw new Error(progError.message);

    // 3. C√†lculs (Igual que abans)
    const completedSet = new Set(progress?.map(p => p.challenge_id));
   const statsMap = new Map<number, TierProgressStats>();

    challenges.forEach(c => {
      const tier = c.difficulty_tier;
      
      // ‚úÖ CORRECCI√ì 3: Cast segur al nostre tipus (ChallengeType) en lloc de 'any'
      // Supabase retorna string, nosaltres li diem a TS que confiem que √©s un dels nostres tipus.
      const type = c.type as ChallengeType; 

      if (!statsMap.has(tier)) {
        statsMap.set(tier, {
          tier,
          totalChallenges: 0,
          completedChallenges: 0,
          mostCommonType: type // Usem la variable tipada
        });
      }
      const stat = statsMap.get(tier)!;
      stat.totalChallenges++;
      if (completedSet.has(c.id)) {
        stat.completedChallenges++;
      }
    });

    return Array.from(statsMap.values()).sort((a, b) => a.tier - b.tier);
  }

  
}

// =================== FILE: src/infrastructure/repositories/supabase/user.repository.ts ===================

// filepath: src/infrastructure/repositories/supabase/user.repository.ts
import { createClient } from '@/infrastructure/utils/supabase/server';
import { IUserRepository, UserProfile } from '@/core/repositories/user.repository'; // Assegura't que aquesta interf√≠cie existeix al Core

export class SupabaseUserRepository implements IUserRepository {
  
  async findById(userId: string): Promise<UserProfile | null> {
    const supabase = await createClient();
    
    // Obtenim el perfil de la taula 'profiles'
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', userId)
      .single();

    if (error) {
      console.error('Error fetching user profile:', error);
      return null;
    }

    return {
      id: data.id,
      totalXp: data.total_xp || 0,
      level: data.level || 1,
      // Mapem altres camps si cal
    };
  }

  async saveProgress(userId: string, challengeIds: string[], topicId: string, xpPerChallenge: number): Promise<void> {
    const supabase = await createClient();

    // Guardem cada repte completat a 'user_progress'
    // Usem upsert per evitar errors si ja existeix
    const progressInserts = challengeIds.map(challengeId => ({
      user_id: userId,
      challenge_id: challengeId,
      topic_id: topicId,
      completed_at: new Date().toISOString(),
      xp_earned: xpPerChallenge
    }));

    const { error } = await supabase
      .from('user_progress') // Assegura't que aquesta taula existeix
      .upsert(progressInserts, { onConflict: 'user_id, challenge_id' });

    if (error) {
      console.error('Error saving progress:', error);
      throw new Error('Database error saving progress');
    }
  }

  async updateXp(userId: string, newTotalXp: number, newLevel: number): Promise<void> {
    const supabase = await createClient();

    const { error } = await supabase
      .from('profiles')
      .update({ 
        total_xp: newTotalXp,
        level: newLevel,
        updated_at: new Date().toISOString()
      })
      .eq('id', userId);

    if (error) {
      console.error('Error updating XP:', error);
      throw new Error('Database error updating XP');
    }
  }
}

// =================== FILE: src/infrastructure/service/supabase-auth.service.ts ===================

// filepath: src/infrastructure/services/supabase-auth.service.ts
import { createClient } from '@/infrastructure/utils/supabase/server';
import { IAuthService, UserIdentity } from '@/core/services/auth.service';

export class SupabaseAuthService implements IAuthService {
  
  async logout(): Promise<void> {
    const supabase = await createClient();
    await supabase.auth.signOut();
  }

  async getUser(): Promise<UserIdentity | null> {
    const supabase = await createClient();
    const { data: { user } } = await supabase.auth.getUser();
    
    if (!user || !user.email) return null;
    
    return {
      id: user.id,
      email: user.email
    };
  }
}

// =================== FILE: src/infrastructure/utils/supabase/server.ts ===================

// filepath: src/infrastructure/utils/supabase/server.ts
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';

export async function createClient() {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
      },
    }
  );
}

// =================== FILE: src/navigation.ts ===================

// filepath: src/navigation.ts
import { createNavigation } from 'next-intl/navigation';
import { routing } from './routing';

// Creem wrappers amb tipatge segur per al routing definit
export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);

// =================== FILE: src/presentation/actions/auth/auth.action.ts ===================

// filepath: src/presentation/actions/auth/auth.action.ts
'use server';

import { createClient } from '@/infrastructure/utils/supabase/server';
import { redirect } from 'next/navigation';

export type AuthState = {
  errorKey?: string; // <--- Canviem 'error' (text) per 'errorKey' (clau i18n)
  messageKey?: string;
};

export async function authAction(prevState: AuthState, formData: FormData): Promise<AuthState> {
  const email = formData.get('email') as string;
  const password = formData.get('password') as string;
  const intent = formData.get('intent') as string;
  
  const supabase = await createClient();

  if (intent === 'signup') {
    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: { data: { full_name: email.split('@')[0] } }
    });

    if (error) {
      // Mapeig d'errors b√†sic
      if (error.message.includes('already registered')) return { errorKey: 'auth.errors.user_already_exists' };
      if (error.message.includes('Password')) return { errorKey: 'auth.errors.weak_password' };
      return { errorKey: 'auth.errors.generic' };
    }

    return { messageKey: 'auth.success.check_email' };
  } 
  
  else {
    const { error } = await supabase.auth.signInWithPassword({ email, password });

    if (error) {
      // Supabase sol retornar "Invalid login credentials" per seguretat
      return { errorKey: 'auth.errors.invalid_credentials' };
    }

    redirect('/');
  }
}

// =================== FILE: src/presentation/actions/auth/logout.actions.ts ===================

// filepath: src/presentation/actions/auth/logout.action.ts
'use server';

import { LogoutUseCase } from '@/application/use-cases/auth/logout.use-case';
import { SupabaseAuthService } from '@/infrastructure/service/supabase-auth.service';
import { redirect } from 'next/navigation'; // Aqu√≠ S√ç usem el natiu

export async function logoutAction() {
  const authService = new SupabaseAuthService();
  const useCase = new LogoutUseCase(authService);
  
  await useCase.execute();
  
  // Truc d'Arquitecte: Redirigim a l'arrel "/"
  // El Middleware detectar√† "/" -> Detectar√† l'idioma del navegador -> Redirigir√† a "/ca/login"
  redirect('/login'); 
}

// =================== FILE: src/presentation/actions/challenges/get-next-challenge.action.ts ===================

// filepath: src/presentation/actions/challenges/get-next-challenge.action.ts
'use server';

import { GetNextChallengeUseCase } from '@/application/use-cases/challenges/get-next-challenge.use-case';
import { SupabaseTopicRepository } from '@/infrastructure/repositories/supabase/topic.repository';
import { SupabaseChallengeRepository } from '@/infrastructure/repositories/supabase/challenge.repository';
import { Challenge } from '@/core/entities/challenge.entity';
import { getLocale } from 'next-intl/server';
import { createClient } from '@/infrastructure/utils/supabase/server'; // <--- Necessari per user real

type ActionResponse = 
  | { success: true; data: Challenge[] } 
  | { success: false; error: string };

// 1. AFEGIM EL PAR√ÄMETRE difficulty AMB VALOR PER DEFECTE
export async function getNextChallengeAction(topicSlug: string, difficulty: number = 1): Promise<ActionResponse> {
  console.log(`üöÄ [ACTION] Rebuda petici√≥: Slug="${topicSlug}", Tier=${difficulty}`);
  
  try {
    const locale = await getLocale();
    const supabase = await createClient(); 

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
        console.warn('‚õî [ACTION] Usuari no autenticat');
        return { success: false, error: 'Has d\'iniciar sessi√≥ per jugar.' };
    }

    const topicRepo = new SupabaseTopicRepository();
    // Afegim log per veure si troba el tema
    const topic = await topicRepo.findBySlug(topicSlug);
    if (!topic) {
        console.error(`‚ùå [ACTION] Tema no trobat pel slug: ${topicSlug}`);
        return { success: false, error: 'Tema no trobat' };
    }
    console.log(`‚úÖ [ACTION] Tema trobat: ID=${topic.id}`);

    const challengeRepo = new SupabaseChallengeRepository();
    
    // NOTA: Ara cridem directament al repo aqu√≠ per saltar-nos el UseCase en el debug, 
    // o b√© deixem el UseCase per√≤ sabent que el log est√† dins del repo.
    // Mantenim l'estructura neta cridant al UseCase:
    
    const useCase = new GetNextChallengeUseCase(topicRepo, challengeRepo);
    const challenges = await useCase.execute(topicSlug, user.id, locale, difficulty); 

    console.log(`üèÅ [ACTION] Retornant ${challenges.length} reptes al client.`);
    return { success: true, data: challenges };

  } catch (error) {
    console.error('‚ùå [ACTION] Exception:', error);
    return { 
      success: false, 
      error: 'No s\'ha pogut carregar el repte.' 
    };
  }
}

// =================== FILE: src/presentation/actions/gamification/submit-session.action.ts ===================

// filepath: src/presentation/actions/gamification/submit-session.action.ts
'use server';

import { CompleteSessionUseCase, SessionResult } from '@/application/use-cases/gamification/complete-session.use-case';
import { SupabaseUserRepository } from '@/infrastructure/repositories/supabase/user.repository';
import { createClient } from '@/infrastructure/utils/supabase/server'; // <--- Nou import

type ActionResponse = 
  | { success: true; data: SessionResult }
  | { success: false; error: string };

export async function submitSessionAction(challengeIds: string[], topicId: string): Promise<ActionResponse> {
  try {
    // 1. Obtenim l'usuari real de la sessi√≥
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return { success: false, error: 'Unauthorized: Please login first' };
    }

    // 2. Ja tenim l'ID real!
    const userId = user.id;

    // 3. Executem el cas d'√∫s
    const userRepo = new SupabaseUserRepository();
    const useCase = new CompleteSessionUseCase(userRepo);

    const result = await useCase.execute(userId, challengeIds, topicId);

    return { success: true, data: result };
  } catch (error) {
    console.error('Error submitting session:', error);
    return { success: false, error: 'Failed to save progress' };
  }
}

// =================== FILE: src/presentation/actions/topics/get-topics.action.ts ===================

// filepath: src/presentation/actions/topics/get-topics.action.ts
'use server';

import { GetActiveTopicsUseCase } from '@/application/use-cases/topics/get-active-topics.use-case';
import { SupabaseTopicRepository } from '@/infrastructure/repositories/supabase/topic.repository';
import { Topic } from '@/core/entities/topic.entity';

// Definim un tipus de retorn est√†ndard per a les accions
type ActionResponse<T> = 
  | { success: true; data: T }
  | { success: false; error: string };

export async function getTopicsAction(): Promise<ActionResponse<Topic[]>> {
  try {
    // 1. Instanciem les depend√®ncies (Composition Root per request)
    // Nota: M√©s endavant injectarem el client de Supabase amb cookies aqu√≠.
    const repository = new SupabaseTopicRepository();
    const useCase = new GetActiveTopicsUseCase(repository);

    // 2. Executem el cas d'√∫s
    const topics = await useCase.execute();

    // 3. Retornem l'√®xit
    // Next.js serialitzar√† aix√≤ autom√†ticament
    return { success: true, data: topics };
  } catch (error) {
    console.error('Error fetching topics:', error);
    // 4. Gesti√≥ d'errors segura (no enviem stack trace al client)
    return { 
      success: false, 
      error: 'No s\'han pogut carregar els temes. Torna-ho a provar m√©s tard.' 
    };
  }
}

// =================== FILE: src/presentation/components/auth/LogoutButton.tsx ===================

// filepath: src/presentation/components/auth/LogoutButton.tsx
'use client';

import { LogOut } from 'lucide-react';
import { logoutAction } from '@/presentation/actions/auth/logout.actions';

export function LogoutButton() {
  return (
    <button 
      onClick={() => logoutAction()}
      className="flex items-center gap-2 text-slate-400 hover:text-red-400 transition-colors text-sm font-medium p-2 rounded-lg hover:bg-red-500/10 w-full"
    >
      <LogOut className="w-4 h-4" />
      <span>Tancar Sessi√≥</span>
    </button>
  );
}

// =================== FILE: src/presentation/components/features/dashboard/TopicCard.tsx ===================

// filepath: src/presentation/components/features/dashboard/TopicCard.tsx
import Link from 'next/link';
import { DashboardTopicDTO } from '@/application/dto/dashboard-topic.dto';
import { getTopicIcon } from '@/presentation/utils/icon-mapper';
import { clsx } from 'clsx';
import { ArrowRight, Lock } from 'lucide-react';

interface TopicCardProps {
  topic: DashboardTopicDTO;
  translatedTitle: string; // <--- NOU CAMP
}

export function TopicCard({ topic, translatedTitle }: TopicCardProps) {
  const themeColor = topic.colorTheme || 'bg-slate-700';

  return (
    <Link 
      href={topic.isLocked ? '#' : `/learn/${topic.slug}`}
      className={clsx(
        "group relative flex flex-col bg-slate-900 border-2 border-slate-800 rounded-2xl overflow-hidden transition-all duration-200",
        !topic.isLocked && "hover:-translate-y-1 hover:border-blue-500/50 hover:shadow-[0_8px_0_0_#1e293b] active:translate-y-0 active:shadow-none",
        topic.isLocked && "opacity-60 cursor-not-allowed grayscale"
      )}
    >
      {/* HEADER DE COLOR */}
      <div className={clsx("h-24 flex items-center justify-center relative overflow-hidden", themeColor)}>
         <div className="absolute inset-0 bg-black/10" /> {/* Overlay subtil */}
         <div className="text-white drop-shadow-md transform group-hover:scale-110 transition-transform duration-300">
            {getTopicIcon(topic.iconName, "w-12 h-12")}
         </div>
      </div>

      {/* BODY */}
      <div className="p-5 flex-1 flex flex-col">
       <h3 className="text-lg font-bold text-white mb-1">{translatedTitle}</h3>
        <p className="text-slate-400 text-xs mb-4 line-clamp-2">{topic.description}</p>

        {/* BARRA DE PROGR√âS */}
        <div className="mt-auto">
           <div className="flex justify-between text-xs font-bold mb-1.5 uppercase tracking-wider">
              <span className={topic.isLocked ? "text-slate-600" : "text-blue-400"}>
                 {topic.isLocked ? "Bloquejat" : `Nivell ${topic.currentLevel}`}
              </span>
              <span className="text-slate-500">{topic.progressPercentage}%</span>
           </div>
           
           <div className="h-3 w-full bg-slate-800 rounded-full overflow-hidden border border-slate-700/50">
              <div 
                className={clsx("h-full rounded-full transition-all duration-1000", 
                    topic.isLocked ? "bg-slate-600" : "bg-blue-500"
                )}
                style={{ width: `${topic.progressPercentage}%` }}
              />
           </div>
        </div>
      </div>

      {/* BOT√ì D'ACCI√ì (Nom√©s visible en hover o m√≤bil) */}
      {!topic.isLocked && (
          <div className="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
             <div className="bg-white/20 p-2 rounded-full backdrop-blur-sm">
                <ArrowRight className="w-4 h-4 text-white" />
             </div>
          </div>
      )}
      
      {topic.isLocked && (
         <div className="absolute top-3 right-3">
             <Lock className="w-5 h-5 text-white/50" />
         </div>
      )}
    </Link>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/ChallengeRenderer.tsx ===================

import { Challenge } from '@/core/entities/challenge.entity';
import { QuizView } from './QuizView';
import { MatchingView } from './MatchingView'; // <--- IMPORTAR
import { CodeFixView } from './CodeFixView';   // <--- IMPORTAR

interface ChallengeRendererProps {
  challenge: Challenge;
  onNext: (isCorrect: boolean) => void;
}

export function ChallengeRenderer({ challenge, onNext }: ChallengeRendererProps) {
  
  switch (challenge.type) {
    case 'QUIZ':
      return (
        <QuizView 
          key={challenge.id}
          challenge={challenge} 
          onNext={onNext} 
        />
      );
    
    case 'MATCHING':
      return (
         <MatchingView 
            key={challenge.id}
            challenge={challenge} 
            onNext={onNext} 
         />
      );

    case 'CODE_FIX':
       return (
          <CodeFixView 
             key={challenge.id}
             challenge={challenge}
             onNext={onNext}
          />
       );

    default:
      return <div className="text-red-500">Tipus de joc no suportat: {challenge.type}</div>;
  }
}

// =================== FILE: src/presentation/components/features/game-engine/code-fix/CodeWindow.tsx ===================

import { clsx } from 'clsx';

// Motor de sintaxi optimitzat
const SyntaxHighlighter = ({ code }: { code: string }) => {
  const parts = code.split(/(\s+|[(){}[\]<>=;])/g);
  return (
    <span className="font-mono text-sm md:text-base leading-relaxed">
      {parts.map((part, i) => {
        if (['function', 'const', 'let', 'var', 'return', 'if', 'else', 'export', 'default'].includes(part)) 
          return <span key={i} className="text-pink-500">{part}</span>;
        if (['useState', 'useEffect', 'useContext', 'useMemo'].includes(part)) 
          return <span key={i} className="text-yellow-300 font-medium">{part}</span>;
        if (part.startsWith('<') || part.startsWith('</') || part.endsWith('>')) 
          return <span key={i} className="text-blue-400">{part}</span>;
        if (part.match(/^[A-Z]/) && !['A', 'B', 'C'].includes(part)) 
          return <span key={i} className="text-yellow-400">{part}</span>;
        if (['=', '=>', '==='].includes(part)) 
          return <span key={i} className="text-blue-300">{part}</span>;
        return <span key={i} className="text-blue-100/90">{part}</span>;
      })}
    </span>
  );
};

interface CodeWindowProps {
  initialCode: string;
  selectedCode?: string | null;
  isError?: boolean;
  isSuccess?: boolean;
}

export function CodeWindow({ initialCode, selectedCode, isError, isSuccess }: CodeWindowProps) {
  // Calculem les l√≠nies totals per als n√∫meros de l√≠nia
  const lines = initialCode.split('\n');
  
  // Dividim el codi pel marcador per saber en quina l√≠nia cau el "forat"
  const parts = initialCode.split('???');
  const preCode = parts[0];
  const postCode = parts[1] || '';

  return (
    <div className="bg-[#1e1e1e] rounded-xl overflow-hidden shadow-2xl border border-slate-700 ring-4 ring-black/20 mt-4">
      
      {/* 1. BARRA DE T√çTOL (VSCODE STYLE) */}
      <div className="bg-[#252526] px-4 py-2 flex items-center gap-2 border-b border-[#333]">
        <div className="flex gap-1.5 mr-4">
          <div className="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
          <div className="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
          <div className="w-3 h-3 rounded-full bg-[#27c93f]"></div>
        </div>
        
        {/* Pestanya activa */}
        <div className="flex items-center gap-2 px-3 py-1.5 bg-[#1e1e1e] rounded-t-md text-[11px] text-blue-300 font-mono border-t border-x border-[#333] -mb-[9px] z-10">
          <span className="text-yellow-500 text-[10px] font-bold">JS</span> 
          Solution.jsx
        </div>
      </div>

      {/* 2. AREA DE CODI AMB N√öMEROS DE L√çNIA */}
      <div className="flex relative min-h-[160px]">
        
        {/* Columna de n√∫meros */}
        <div className="bg-[#1e1e1e] w-12 py-6 flex flex-col items-end pr-4 text-slate-600 font-mono text-xs select-none border-r border-[#333]">
          {lines.map((_, i) => (
            <div key={i} className="leading-relaxed h-[1.5rem]">{i + 1}</div>
          ))}
        </div>

        {/* Editor de codi */}
        <div className="flex-1 p-6 py-6 font-mono overflow-x-auto bg-[#1e1e1e]/50">
          <div className="whitespace-pre">
            <SyntaxHighlighter code={preCode} />
            
            {/* EL "FORAT" INTERACTIU */}
            <span className={clsx(
              "px-3 py-1 rounded-md mx-1 font-bold transition-all duration-300 inline-block min-w-20 text-center",
              "border-b-2 shadow-inner",
              !selectedCode ? "bg-slate-800 text-slate-500 border-slate-600 animate-pulse italic text-sm" :
              isSuccess ? "bg-green-500/20 text-green-400 border-green-500 scale-110 shadow-[0_0_15px_rgba(34,197,94,0.2)]" :
              isError ? "bg-red-500/20 text-red-400 border-red-500 shake-animation" :
              "bg-blue-500/20 text-blue-300 border-blue-500"
            )}>
              {selectedCode || "???"}
            </span>

            <SyntaxHighlighter code={postCode} />
          </div>
        </div>
      </div>

      {/* 3. FOOTER DE L'EDITOR */}
      <div className="bg-[#252526] px-4 py-1 border-t border-[#333] flex justify-between items-center text-[10px] font-mono text-slate-500 uppercase tracking-widest">
        <div className="flex gap-4">
          <span>Ln {lines.length}, Col 1</span>
          <span>Spaces: 2</span>
        </div>
        <div className="flex gap-2 items-center">
          <div className="w-2 h-2 rounded-full bg-blue-500"></div>
          <span>JavaScript JSX</span>
        </div>
      </div>
    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/code-fix/HintPanel.tsx ===================

// filepath: src/presentation/components/features/game-engine/code-fix/HintPanel.tsx
import { useState } from 'react';
import { Lightbulb, X } from 'lucide-react';


interface HintPanelProps {
  hintText: string;
}

export function HintPanel({ hintText }: HintPanelProps) {
  const [isOpen, setIsOpen] = useState(false);

  if (!isOpen) {
    return (
      <button 
        onClick={() => setIsOpen(true)}
        className="flex items-center gap-2 text-xs text-yellow-500/80 hover:text-yellow-400 transition-colors mt-2 ml-auto"
      >
        <Lightbulb className="w-4 h-4" /> Necessito una pista
      </button>
    );
  }

  return (
    <div className="mt-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3 flex items-start gap-3 animate-in fade-in slide-in-from-top-1">
       <Lightbulb className="w-4 h-4 text-yellow-500 shrink-0 mt-0.5" />
       <p className="text-yellow-200/90 text-sm flex-1">{hintText}</p>
       <button onClick={() => setIsOpen(false)} className="text-yellow-500/50 hover:text-yellow-500">
         <X className="w-4 h-4" />
       </button>
    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/code-fix/SolutionDeck.tsx ===================

// filepath: src/presentation/components/features/game-engine/code-fix/SolutionDeck.tsx
import { CodeFixOption } from '@/core/entities/challenge.entity';
import { clsx } from 'clsx';

interface SolutionDeckProps {
  options: CodeFixOption[];
  selectedId: string | null;
  onSelect: (id: string) => void;
  isSubmitted: boolean;
}

export function SolutionDeck({ options, selectedId, onSelect, isSubmitted }: SolutionDeckProps) {
  return (
    <div className="grid grid-cols-3 gap-4 mt-6">
      {options.map((opt) => {
        const isSelected = selectedId === opt.id;
        
        return (
          <button
            key={opt.id}
            onClick={() => onSelect(opt.id)}
            disabled={isSubmitted && isSelected} // Bloquegem nom√©s si ja hem enviat
            className={clsx(
              "p-4 rounded-xl border-2 font-mono text-sm transition-all duration-200 shadow-lg hover:-translate-y-1",
              isSelected 
                ? "bg-blue-600 border-blue-400 text-white ring-2 ring-blue-400/50" 
                : "bg-slate-800 border-slate-700 text-slate-300 hover:border-slate-500 hover:bg-slate-750"
            )}
          >
            {opt.code}
          </button>
        );
      })}
    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/CodeFixView.tsx ===================

'use client';

import { useState } from 'react';
import { Challenge, CodeFixContent } from '@/core/entities/challenge.entity';
import { Terminal, Play, ArrowRight } from 'lucide-react';
import { CodeWindow } from './code-fix/CodeWindow';
import { SolutionDeck } from './code-fix/SolutionDeck';
import { HintPanel } from './code-fix/HintPanel';
import { clsx } from 'clsx';

interface CodeFixViewProps {
  challenge: Challenge;
  onNext: (isCorrect: boolean) => void;
}

export function CodeFixView({ challenge, onNext }: CodeFixViewProps) {
  const content = challenge.content as CodeFixContent;
  
  const [selectedId, setSelectedId] = useState<string | null>(null);
  const [status, setStatus] = useState<'IDLE' | 'SUCCESS' | 'ERROR'>('IDLE');

  const handleCheck = () => {
    if (!selectedId) return;

    const selectedOption = content.options.find(opt => opt.id === selectedId);
    
    if (selectedOption?.isCorrect) {
       setStatus('SUCCESS');
       // Donem temps per veure l'animaci√≥ d'√®xit abans de passar
       // No fem onNext autom√†tic, deixem que l'usuari cliqui "Continuar" o autom√†tic despr√©s de delay
       setTimeout(() => onNext(true), 1500); 
    } else {
       setStatus('ERROR');
       // Reset de l'error despr√©s d'un moment
       setTimeout(() => setStatus('IDLE'), 1000);
    }
  };

  const currentCode = selectedId 
    ? content.options.find(o => o.id === selectedId)?.code 
    : null;

  return (
    <div className="w-full max-w-3xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500">
      
      {/* HEADER */}
      <div className="flex items-center gap-3 mb-2 text-slate-300">
         <div className="p-2 bg-blue-500/10 rounded-lg">
            <Terminal className="w-5 h-5 text-blue-400" />
         </div>
         <h2 className="font-mono font-bold text-lg text-white">DEBUG_MODE</h2>
      </div>
      
      <p className="text-slate-400 text-sm mb-6 ml-12">
         {content.description}
      </p>

      {/* COMPONENT VISUAL 1: Editor */}
      <CodeWindow 
         initialCode={content.initialCode} 
         selectedCode={currentCode}
         isError={status === 'ERROR'}
         isSuccess={status === 'SUCCESS'}
      />

      {/* COMPONENT VISUAL 2: Cartes */}
      <SolutionDeck 
         options={content.options} 
         selectedId={selectedId} 
         onSelect={(id) => {
             setSelectedId(id);
             setStatus('IDLE');
         }}
         isSubmitted={status === 'SUCCESS'}
      />

      {/* COMPONENT VISUAL 3: Pista */}
      <HintPanel hintText={content.hint} />

      {/* ACCI√ì PRINCIPAL */}
      <div className="mt-8 flex justify-end border-t border-slate-800 pt-6">
         <button
            onClick={handleCheck}
            disabled={!selectedId || status === 'SUCCESS'}
            className={clsx(
               "px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg",
               !selectedId ? "bg-slate-800 text-slate-500 cursor-not-allowed" :
               status === 'SUCCESS' ? "bg-green-600 text-white hover:scale-105" :
               "bg-blue-600 hover:bg-blue-500 text-white hover:scale-105"
            )}
         >
            {status === 'SUCCESS' ? 'CODI ARREGLAT!' : 'EXECUTAR CODI'} 
            {status === 'SUCCESS' ? <ArrowRight className="w-5 h-5" /> : <Play className="w-4 h-4 fill-current" />}
         </button>
      </div>

    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/GameArena.tsx ===================

// filepath: src/presentation/components/features/game-engine/GameArena.tsx
'use client';

import { Challenge } from '@/core/entities/challenge.entity';
import { useGameSession } from '@/presentation/hooks/game/useGameSession';
// ‚ùå ELIMINA: import { QuizView } from './QuizView'; (Ja no cal aqu√≠)
import { ChallengeRenderer } from './ChallengeRenderer'; // ‚úÖ AQUEST √âS EL BO
import { GameResult } from './GameResult';
import { GameError } from './GameError';
import { Loader2 } from 'lucide-react';
import { useTranslations } from 'next-intl';

interface GameArenaProps {
  challenges: Challenge[];
  topicSlug: string;
}

export function GameArena({ challenges, topicSlug }: GameArenaProps) {
  const t = useTranslations('game.arena');
  
  const { 
    currentChallenge, 
    currentIndex, 
    totalChallenges, 
    progress, 
    status, 
    result, 
    error, 
    handleNext, 
    handleRetry 
  } = useGameSession(challenges);

  // 1. ESTAT: CARREGANT
  if (status === 'SUBMITTING') {
    return (
      <div className="flex flex-col items-center justify-center h-64">
        <Loader2 className="w-10 h-10 text-blue-500 animate-spin mb-4" />
        <p className="text-slate-400 animate-pulse">{t('loading')}</p>
      </div>
    );
  }

  // 2. ESTAT: √àXIT
  if (status === 'SUCCESS' && result) {
    return (
        <GameResult 
            xpEarned={result.xpEarned} 
            newLevel={result.newLevel} 
            leveledUp={result.leveledUp} 
            topicSlug={topicSlug}
        />
    );
  }

  // 3. ESTAT: ERROR
  if (status === 'ERROR' && error) {
    return <GameError message={error} onRetry={handleRetry} />;
  }

  // 4. ESTAT: JUGANT
  return (
    <div className="w-full max-w-3xl mx-auto">
      {/* BARRA DE PROGR√âS */}
      <div className="mb-8 px-4">
        <div className="flex justify-between text-xs text-slate-400 mb-2 uppercase font-bold tracking-wider">
          <span>{t('progress')}</span>
          <span>{currentIndex + 1} / {totalChallenges}</span>
        </div>
        <div className="w-full bg-slate-800 h-3 rounded-full overflow-hidden">
          <div 
            className="bg-blue-500 h-full transition-all duration-500"
            style={{ width: `${progress}%` }} 
          />
        </div>
      </div>

      {/* ZONA DE JOC */}
      <div className="animate-in slide-in-from-right-8 duration-300">
        
        {/* üõë ASSEGURA'T QUE NOM√âS TENS AIX√í! 
            Si tens un 'if (type === QUIZ)' aqu√≠ a sobre, ESBORRA'L.
        */}
        
        <ChallengeRenderer 
           challenge={currentChallenge}
           onNext={handleNext}
        />

      </div>
    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/GameError.tsx ===================

// filepath: src/presentation/components/features/game-engine/GameError.tsx
import { AlertTriangle, RotateCcw, LogIn } from 'lucide-react';
import { Link } from '@/navigation';
import { useTranslations } from 'next-intl';

interface GameErrorProps {
  message: string;
  onRetry: () => void;
}

export function GameError({ message, onRetry }: GameErrorProps) {
  const t = useTranslations('game.arena');
  const isAuthError = message.includes('Unauthorized');

  return (
    <div className="text-center max-w-sm bg-slate-800 p-8 rounded-2xl border border-red-500/20 mx-auto">
      <div className="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
         {isAuthError ? <LogIn className="w-8 h-8 text-blue-400" /> : <AlertTriangle className="w-8 h-8 text-red-400" />}
      </div>
      
      <h3 className="text-xl font-bold text-white mb-2">
        {isAuthError ? t('unauthorized_title') : t('error_title')}
      </h3>
      
      {/* Si l'error √©s t√®cnic, el mostrem tal qual o un gen√®ric si prefereixes */}
      <p className="text-slate-400 mb-6 text-sm">
        {isAuthError ? t('unauthorized_desc') : message}
      </p>

      <div className="flex gap-3 justify-center">
        {isAuthError ? (
           <Link href="/login">
             <button className="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg">
                {t('login_btn')}
             </button>
           </Link>
        ) : (
           <button onClick={onRetry} className="px-6 py-2 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg flex items-center gap-2">
             <RotateCcw className="w-4 h-4" /> {t('retry_btn')}
           </button>
        )}
      </div>
    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/GameResult.tsx ===================

// filepath: src/presentation/components/features/game-engine/GameResult.tsx
import { Trophy, Star, ArrowRight } from 'lucide-react';
import { Link } from '@/navigation'; // ‚úÖ Import correcte
import { useTranslations } from 'next-intl';

interface GameResultProps {
  xpEarned: number;
  newLevel: number;
  leveledUp: boolean;
  topicSlug: string; // <--- NOVA PROP NECESS√ÄRIA
}

export function GameResult({ xpEarned, newLevel, leveledUp, topicSlug }: GameResultProps) {
  const t = useTranslations('game.arena');

  return (
    <div className="flex flex-col items-center animate-in zoom-in-50">
      <div className="w-32 h-32 bg-yellow-500/10 rounded-full flex items-center justify-center mb-6 relative">
        <Trophy className="w-16 h-16 text-yellow-400" />
        {leveledUp && (
          <div className="absolute -top-2 -right-2 bg-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full animate-bounce">
            {t('level_up')}
          </div>
        )}
      </div>
      
      <h2 className="text-3xl font-bold text-white mb-6">{t('lesson_complete')}</h2>
      
      <div className="bg-slate-800 p-6 rounded-xl w-full max-w-sm mb-6 space-y-4">
         <div className="flex justify-between items-center text-slate-300">
            <span>{t('xp_earned')}</span>
            <span className="text-green-400 font-bold flex gap-1 items-center">
                +{xpEarned} <Star className="w-4 h-4 fill-green-400" />
            </span>
         </div>
         <div className="flex justify-between items-center text-slate-300 pt-4 border-t border-slate-700">
            <span>Nivell Actual</span>
            <span className="text-white font-bold text-xl">{newLevel}</span>
         </div>
      </div>

      {/* ARA TORNA AL MAPA DEL TEMA */}
      <Link href={`/learn/${topicSlug}`}>
        <button className="px-8 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-500 transition-all flex items-center gap-2">
            {t('continue_btn') || "Continuar"} <ArrowRight className="w-5 h-5" />
        </button>
      </Link>
    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/MatchingView.tsx ===================

'use client';

import { useState, useMemo } from 'react';
import { Challenge, MatchingContent } from '@/core/entities/challenge.entity';
import { Check, ArrowRight, Puzzle } from 'lucide-react';
import { clsx } from 'clsx';

// --- UTILS ---

function pseudoRandom(seed: number) {
  let t = seed += 0x6D2B79F5;
  t = Math.imul(t ^ t >>> 15, t | 1);
  t ^= t + Math.imul(t ^ t >>> 7, t | 61);
  return ((t ^ t >>> 14) >>> 0) / 4294967296;
}

function cyrb53(str: string, seed = 0) {
  let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
  for (let i = 0, ch; i < str.length; i++) {
    ch = str.charCodeAt(i);
    h1 = Math.imul(h1 ^ ch, 2654435761);
    h2 = Math.imul(h2 ^ ch, 1597334677);
  }
  h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);
  h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);
  return 4294967296 * (2097151 & h2) + (h1 >>> 0);
}

// ‚úÖ CORRECCI√ì 1: Protecci√≥ contra arrays nuls o indefinits
function seededShuffle<T>(array: T[] | undefined | null, seedString: string): T[] {
  if (!array || !Array.isArray(array)) {
      console.warn("seededShuffle rebut un array inv√†lid:", array);
      return []; 
  }
  const copy = [...array];
  let seed = cyrb53(seedString);

  for (let i = copy.length - 1; i > 0; i--) {
    const randomFloat = pseudoRandom(seed++);
    const j = Math.floor(randomFloat * (i + 1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy;
}

// --- COMPONENT ---

interface MatchingViewProps {
  challenge: Challenge;
  onNext: (isCorrect: boolean) => void;
}

export function MatchingView({ challenge, onNext }: MatchingViewProps) {
  const content = challenge.content as MatchingContent;
  
  // ESTAT UI
  const [selectedLeft, setSelectedLeft] = useState<string | null>(null);
  const [matchedPairs, setMatchedPairs] = useState<Set<string>>(new Set());
  const [errorPair, setErrorPair] = useState<{left: string, right: string} | null>(null);
  const [isCompleted, setIsCompleted] = useState(false);

  // ‚úÖ CORRECCI√ì 2: Protecci√≥ dins del useMemo
  const rightOptions = useMemo(() => {
    // Si no hi ha contingut o no hi ha pairs, retornem buit per evitar l'error
    if (!content || !content.pairs) return [];
    
    return seededShuffle(content.pairs, challenge.id);
  }, [content, challenge.id]);

  // Si no hi ha parelles carregades, mostrem un error o loader en lloc de petar
  if (!content?.pairs || content.pairs.length === 0) {
      return <div className="text-center p-10 text-red-400">Error: No s'han trobat parelles per relacionar.</div>;
  }

  const handleLeftClick = (id: string) => {
    if (matchedPairs.has(id)) return; 
    setSelectedLeft(id);
    setErrorPair(null);
  };

  const handleRightClick = (rightId: string) => {
    if (!selectedLeft) return; 

    const pair = content.pairs.find(p => p.left.id === selectedLeft);

    if (pair && pair.right.id === rightId) {
      const newMatches = new Set(matchedPairs);
      newMatches.add(selectedLeft);
      setMatchedPairs(newMatches);
      setSelectedLeft(null);

      if (newMatches.size === content.pairs.length) {
        setIsCompleted(true);
      }
    } else {
      setErrorPair({ left: selectedLeft, right: rightId });
      setTimeout(() => {
        setErrorPair(null);
        setSelectedLeft(null);
      }, 800);
    }
  };

  return (
    <div className="w-full max-w-4xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500">
      
      <div className="text-center mb-8">
         <div className="inline-flex items-center justify-center p-3 bg-purple-500/10 rounded-full mb-4">
            <Puzzle className="w-8 h-8 text-purple-400" />
         </div>
         <h2 className="text-xl md:text-2xl font-bold text-white">
            {content.instruction}
         </h2>
         <p className="text-slate-400 mt-2 text-sm">Selecciona un element de cada columna per relacionar-los.</p>
      </div>

      <div className="grid grid-cols-2 gap-8 md:gap-12 relative">
         
         {/* COLUMNA ESQUERRA */}
         <div className="flex flex-col gap-4">
            {content.pairs.map((pair) => {
               const isMatched = matchedPairs.has(pair.left.id);
               const isSelected = selectedLeft === pair.left.id;
               const isError = errorPair?.left === pair.left.id;

               return (
                  <button
                    key={pair.left.id}
                    onClick={() => handleLeftClick(pair.left.id)}
                    disabled={isMatched}
                    className={clsx(
                       "p-4 rounded-xl border-2 text-left transition-all duration-300 relative select-none",
                       isMatched ? "bg-green-500/10 border-green-500 text-green-400 opacity-50" :
                       isError ? "bg-red-500/10 border-red-500 text-red-400 shake-animation" :
                       isSelected ? "bg-blue-600/20 border-blue-500 text-blue-200 scale-105 shadow-lg shadow-blue-500/20" :
                       "bg-slate-800 border-slate-700 text-slate-300 hover:border-slate-500 hover:bg-slate-700"
                    )}
                  >
                     {pair.left.text}
                     {isMatched && <Check className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5" />}
                  </button>
               );
            })}
         </div>

         {/* COLUMNA DRETA */}
         <div className="flex flex-col gap-4">
            {rightOptions.map((pair) => {
               const originalPair = content.pairs.find(p => p.right.id === pair.right.id);
               // Safe navigation operator ?. per evitar crash si originalPair no es troba
               const isMatched = originalPair && matchedPairs.has(originalPair.left.id);
               const isError = errorPair?.right === pair.right.id;

               return (
                  <button
                    key={pair.right.id}
                    onClick={() => handleRightClick(pair.right.id)}
                    disabled={isMatched || !selectedLeft}
                    className={clsx(
                       "p-4 rounded-xl border-2 text-left transition-all duration-300 relative select-none",
                       isMatched ? "bg-green-500/10 border-green-500 text-green-400 opacity-50" :
                       isError ? "bg-red-500/10 border-red-500 text-red-400 shake-animation" :
                       selectedLeft && !isMatched ? "bg-slate-800 border-slate-600 cursor-pointer hover:border-purple-400 hover:bg-slate-700" :
                       "bg-slate-800 border-slate-800 text-slate-500 cursor-not-allowed opacity-60"
                    )}
                  >
                     {pair.right.text}
                  </button>
               );
            })}
         </div>
      </div>

      {isCompleted && (
         <div className="mt-8 flex justify-center animate-in zoom-in duration-300">
            <button
               onClick={() => onNext(true)}
               className="px-8 py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl flex items-center gap-2 shadow-lg hover:scale-105 transition-all"
            >
               NIVELL SUPERAT <ArrowRight className="w-5 h-5" />
            </button>
         </div>
      )}

    </div>
  );
}

// =================== FILE: src/presentation/components/features/game-engine/QuizView.tsx ===================

// filepath: src/presentation/components/features/game-engine/QuizView.tsx
'use client';

import { useState } from 'react';
import { Challenge, QuizContent } from '@/core/entities/challenge.entity';
import { CheckCircle2, XCircle, ArrowRight } from 'lucide-react';
import { clsx } from 'clsx';
import { useTranslations } from 'next-intl';

interface QuizViewProps {
  challenge: Challenge;
  // ‚úÖ CORRECCI√ì 1: La signatura ha de coincidir amb el que envia el pare
  onNext: (isCorrect: boolean) => void;
}

export function QuizView({ challenge, onNext }: QuizViewProps) {
  // const t = useTranslations('game.quiz'); 
  
  const [selectedOptionId, setSelectedOptionId] = useState<string | null>(null);
  const [isSubmitted, setIsSubmitted] = useState(false);

  const content = challenge.content as QuizContent;

  const handleOptionClick = (optionId: string) => {
    if (isSubmitted) return; 
    setSelectedOptionId(optionId);
    setIsSubmitted(true);
  };

  // ‚úÖ CORRECCI√ì 2: Funci√≥ per gestionar el click a "Continuar"
  const handleContinue = () => {
    // Calculem si √©s correcte buscant l'√≠ndex de l'ID seleccionat
    const selectedIndex = content.options.findIndex(o => o.id === selectedOptionId);
    const isCorrect = selectedIndex === content.correctOptionIndex;
    
    // Avisem al pare amb el resultat
    onNext(isCorrect);
  };

  const getOptionStyles = (optionId: string, index: number) => {
    if (!isSubmitted) {
      return "border-slate-700 bg-slate-800/50 hover:bg-slate-700 hover:border-blue-500/50 text-slate-300 cursor-pointer active:scale-[0.98]";
    }

    const isCorrect = index === content.correctOptionIndex;
    const isSelected = optionId === selectedOptionId;

    if (isCorrect) {
      return "border-green-500 bg-green-500/20 text-green-400 shadow-[0_0_15px_rgba(34,197,94,0.3)] font-bold";
    }

    if (isSelected && !isCorrect) {
      return "border-red-500 bg-red-500/10 text-red-400 opacity-90 shake-animation"; 
    }

    return "border-slate-800 bg-slate-900/50 text-slate-600 opacity-40 grayscale";
  };

  // Helpers per determinar l'estat actual visualment
  const selectedIndex = content.options.findIndex(o => o.id === selectedOptionId);
  const isCorrectAnswer = selectedIndex === content.correctOptionIndex;

  return (
    <div className="w-full max-w-2xl mx-auto flex flex-col gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
      
      {/* PREGUNTA */}
      <div className="bg-slate-900/80 p-6 rounded-2xl border border-slate-800 shadow-xl backdrop-blur-sm relative overflow-hidden">
        <div className="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2" />
        <h2 className="text-xl md:text-2xl font-bold text-white leading-relaxed relative z-10">
          {content.question}
        </h2>
      </div>

      {/* OPCIONS */}
      <div className="grid gap-3">
        {content.options.map((option, index) => {
            const isOptCorrect = index === content.correctOptionIndex;
            const isOptSelected = option.id === selectedOptionId;

            return (
              <button
                key={option.id}
                onClick={() => handleOptionClick(option.id)}
                disabled={isSubmitted}
                className={clsx(
                  "w-full text-left p-4 rounded-xl border-2 transition-all duration-300 flex items-center justify-between group relative overflow-hidden",
                  getOptionStyles(option.id, index)
                )}
              >
                <div className="flex items-center gap-4 z-10 w-full">
                    {/* Badge A, B, C... */}
                    <div className={clsx(
                        "w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold border transition-colors",
                        isSubmitted && isOptCorrect ? "bg-green-500 border-green-500 text-slate-900" :
                        isSubmitted && isOptSelected ? "bg-red-500 border-red-500 text-white" :
                        "bg-slate-800 border-slate-600 text-slate-400 group-hover:border-blue-500 group-hover:text-blue-400"
                    )}>
                        {String.fromCharCode(65 + index)}
                    </div>
                    
                    <span className="font-medium text-lg flex-1">{option.text}</span>

                    {isSubmitted && isOptCorrect && (
                        <CheckCircle2 className="w-6 h-6 text-green-400 animate-in zoom-in spin-in-90 duration-300" />
                    )}
                    {isSubmitted && isOptSelected && !isOptCorrect && (
                        <XCircle className="w-6 h-6 text-red-400 animate-in zoom-in duration-300" />
                    )}
                </div>
              </button>
            );
        })}
      </div>

      {/* FEEDBACK & NEXT BUTTON */}
      {isSubmitted && (
        <div className={clsx(
            "rounded-2xl p-1 animate-in slide-in-from-bottom-2 duration-300 overflow-hidden shadow-2xl",
             isCorrectAnswer 
                ? "bg-gradient-to-r from-green-500 to-emerald-600" 
                : "bg-gradient-to-r from-red-500 to-rose-600"
        )}>
           <div className="bg-slate-950 rounded-xl p-5">
               <div className="flex items-start gap-4 mb-4">
                  <div className={clsx("p-3 rounded-full shrink-0", 
                      isCorrectAnswer ? "bg-green-500/20 text-green-400" : "bg-red-500/20 text-red-400"
                  )}>
                      {isCorrectAnswer ? <CheckCircle2 className="w-6 h-6" /> : <XCircle className="w-6 h-6" />}
                  </div>
                  <div>
                      <h3 className={clsx("font-bold text-lg mb-1", isCorrectAnswer ? "text-green-400" : "text-red-400")}>
                          {isCorrectAnswer ? "Correcte!" : "Incorrecte"}
                      </h3>
                      <p className="text-slate-300 text-sm leading-relaxed">
                          {content.explanation}
                      </p>
                  </div>
               </div>

               <button 
                 // ‚úÖ CORRECCI√ì 3: Cridem al handler que passa el boolean, no directament onNext
                 onClick={handleContinue}
                 className={clsx(
                    "w-full py-3.5 font-bold rounded-lg transition-transform active:scale-[0.98] flex items-center justify-center gap-2 shadow-lg",
                    isCorrectAnswer 
                    ? "bg-green-600 hover:bg-green-500 text-white"
                    : "bg-red-600 hover:bg-red-500 text-white"
                 )}
               >
                 CONTINUAR <ArrowRight className="w-5 h-5" />
               </button>
           </div>
        </div>
      )}
    </div>
  );
}

// =================== FILE: src/presentation/components/features/learning-path/LevelNode.tsx ===================

// filepath: src/presentation/components/features/learning-path/LevelNode.tsx
import Link from 'next/link';
import { Check, Lock, Terminal, Puzzle, Brain, User } from 'lucide-react'; 
import { clsx } from 'clsx';
import { LevelStatus } from '@/application/dto/level-node.dto';
import { ChallengeType } from '@/core/entities/challenge.entity';

interface LevelNodeProps {
  tier: number;
  status: LevelStatus;
  slug: string;
  index: number;
  predominantType?: ChallengeType;
  isCurrentPosition?: boolean;
}

// ‚úÖ HELPER EXTERN (Net i eficient)
function getIcon(status: string, type: string) {
  if (status === 'LOCKED') return <Lock className="w-8 h-8" />;
  if (status === 'COMPLETED') return <Check className="w-10 h-10 stroke-3" />;

  switch (type) {
    case 'CODE_FIX': return <Terminal className="w-8 h-8" />;
    case 'MATCHING': return <Puzzle className="w-8 h-8" />;
    default: return <Brain className="w-8 h-8" />;
  }
}

export function LevelNode({ tier, status, slug, index, predominantType = 'QUIZ', isCurrentPosition }: LevelNodeProps) {
  const offsetClass = index % 2 === 0 ? '-translate-x-8' : 'translate-x-8';

  const baseStyles = "relative w-24 h-24 rounded-full flex flex-col items-center justify-center border-b-8 transition-all duration-300 z-10";
  
  const statusStyles = {
    LOCKED: "bg-slate-800 border-slate-950 text-slate-600 cursor-not-allowed grayscale",
    COMPLETED: "bg-emerald-500 border-emerald-700 text-white hover:scale-105",
    ACTIVE: "bg-blue-600 border-blue-800 text-white hover:scale-110 shadow-[0_0_30px_rgba(37,99,235,0.6)]"
  };

  const content = (
    <div className="relative">
        {/* EFECTE ONADES (Nom√©s si √©s ACTIVE) */}
        {status === 'ACTIVE' && (
            <span className="absolute inset-0 rounded-full animate-ping bg-blue-500 opacity-20 duration-1000 scale-150 pointer-events-none"></span>
        )}

        {/* CERCLE PRINCIPAL (Aqu√≠ √©s on aplicaven els estils que et fallaven) */}
        <div className={clsx(baseStyles, statusStyles[status], "group")}>
            
            {/* ICONA */}
            {getIcon(status, predominantType)}
            
            {/* ETIQUETA NIVEL */}
            <div className="absolute -bottom-8 bg-slate-900 text-slate-300 text-xs font-bold px-3 py-1 rounded-full border border-slate-700 whitespace-nowrap">
                NIVELL {tier}
            </div>
        </div>

        {/* INDICADOR "EST√ÄS AQU√ç" */}
        {isCurrentPosition && (
            <div className="absolute -top-12 left-1/2 -translate-x-1/2 flex flex-col items-center animate-bounce-subtle z-20">
                <div className="bg-white text-blue-900 p-1.5 rounded-full border-2 border-blue-500 shadow-lg">
                    <User className="w-5 h-5 fill-current" />
                </div>
                <div className="w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-8 border-t-blue-500 -mt-0.5"></div>
            </div>
        )}
    </div>
  );

  if (status === 'LOCKED') {
    return <div className={clsx("flex justify-center py-6", offsetClass)}>{content}</div>;
  }

  return (
    <div className={clsx("flex justify-center py-6", offsetClass)}>
      <Link href={`/learn/${slug}/play?tier=${tier}`}>
        {content}
      </Link>
    </div>
  );
}

// =================== FILE: src/presentation/components/features/topics/TopicCard.tsx ===================

// filepath: src/presentation/components/features/topics/TopicCard.tsx
import { createElement } from 'react';
import { Topic } from '@/core/entities/topic.entity';
import { getTopicIcon } from '@/presentation/utils/icon-mapper';
import { useTranslations, useLocale } from 'next-intl'; // <--- Importem useLocale
import Link from 'next/link';

interface TopicCardProps {
  topic: Topic;
}

export function TopicCard({ topic }: TopicCardProps) {
  const t = useTranslations(); 
  const locale = useLocale(); // <--- Obtenim l'idioma actual ('ca', 'en', etc.)
  
  const IconComponent = getTopicIcon(topic.iconName);

  return (
    <Link 
      // CORRECCI√ì: Afegim el locale a la ruta
      href={`/${locale}/learn/${topic.slug}`} 
      className="group relative block overflow-hidden rounded-xl bg-slate-800 border border-slate-700 hover:border-blue-500 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/20"
    >
      <div className={`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity ${topic.colorTheme}`} />
      
      <div className="p-6">
        <div className={`w-12 h-12 rounded-lg flex items-center justify-center mb-4 ${topic.colorTheme} bg-opacity-20 text-white`}>
          {createElement(IconComponent, { className: "w-6 h-6" })}
        </div>

        <h3 className="text-xl font-bold text-white mb-2">
          
          {t(topic.nameKey)} 
        </h3>
        
        <div className="flex items-center text-sm text-slate-400 group-hover:text-blue-400 transition-colors">
          <span>{t('dashboard.startTopic')}</span>
          <svg className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
          </svg>
        </div>
      </div>
    </Link>
  );
}

// =================== FILE: src/presentation/components/layout/DesktopNavbar.tsx ===================

// filepath: src/presentation/components/layout/DesktopNavbar.tsx
'use client';

// IMPORTACIONS ARQUITECT√íNIQUES: Usem el nostre wrapper, no el de Next directament
import { Link } from '@/navigation'; 
import { LanguageSwitcher } from '../ui/gamified/LanguagerSwitcher';
import { Button3D } from '../ui/gamified/Button3D';
import { LogOut, User } from 'lucide-react';
import { logoutAction } from '@/presentation/actions/auth/logout.actions';

interface DesktopNavbarProps {
  isLoggedIn: boolean;
}

export function DesktopNavbar({ isLoggedIn }: DesktopNavbarProps) {
  // No necessitem useLocale(), el Link ja sap on som.

  return (
    <header className="hidden md:flex w-full h-20 border-b-2 border-slate-800 bg-slate-900/80 backdrop-blur-md fixed top-0 z-50 px-8 items-center justify-between">
      {/* LOGO - Ruta neta '/' */}
      <Link href="/" className="text-2xl font-black tracking-tighter text-green-500 hover:scale-105 transition-transform">
        edu<span className="text-white">Tech</span>
      </Link>

      {/* ACCIONS DRETA */}
      <div className="flex items-center gap-4">
        <LanguageSwitcher />

        {isLoggedIn ? (
          <div className="flex gap-3">
             {/* Rutes netes sense ${locale} */}
             <Link href="/profile">
                <Button3D variant="outline" className="py-2 px-4 text-sm">
                   <User className="w-4 h-4" /> Perfil
                </Button3D>
             </Link>
             <div onClick={() => logoutAction()} className="cursor-pointer">
                <Button3D variant="danger" className="py-2 px-4 text-sm">
                   <LogOut className="w-4 h-4" />
                </Button3D>
             </div>
          </div>
        ) : (
          <div className="flex gap-3">
            <Link href="/login">
               <Button3D variant="outline" className="py-2 px-6 text-sm">
                 Entrar
               </Button3D>
            </Link>
            <Link href="/register">
               <Button3D variant="primary" className="py-2 px-6 text-sm">
                 Comen√ßar
               </Button3D>
            </Link>
          </div>
        )}
      </div>
    </header>
  );
}

// =================== FILE: src/presentation/components/layout/MobileBottomBar.tsx ===================

// filepath: src/presentation/components/layout/MobileBottomBar.tsx
'use client';

// IMPORTANT: Importem Link i usePathname des de @/navigation
import { Link, usePathname } from '@/navigation';
import { Home, Zap, User, LogIn } from 'lucide-react';
import { clsx } from 'clsx';

interface MobileBottomBarProps {
  isLoggedIn: boolean;
}

export function MobileBottomBar({ isLoggedIn }: MobileBottomBarProps) {
  // Aquest pathname ja ve "net" (ex: '/learn' encara que estiguis a '/ca/learn')
  const pathname = usePathname();

  const navItems = [
    { 
      label: 'Inici', 
      href: '/', 
      icon: Home 
    },
    { 
      label: 'Aprendre', 
      href: '/learn', 
      icon: Zap 
    },
    { 
      label: isLoggedIn ? 'Perfil' : 'Entrar', 
      href: isLoggedIn ? '/profile' : '/login', 
      icon: isLoggedIn ? User : LogIn 
    }
  ];

  return (
    <div className="fixed bottom-0 left-0 w-full bg-slate-900 border-t-2 border-slate-800 px-6 py-2 md:hidden z-40 pb-safe">
      <div className="flex justify-between items-center max-w-sm mx-auto">
        {navItems.map((item) => {
          // Comparaci√≥ directa i neta
          const isActive = pathname === item.href;
          const Icon = item.icon;
          
          return (
            <Link 
              key={item.href} 
              href={item.href}
              className={clsx(
                "flex flex-col items-center gap-1 p-2 transition-all active:scale-90",
                isActive ? "text-blue-400" : "text-slate-500 hover:text-slate-300"
              )}
            >
              <div className={clsx(
                "p-2 rounded-xl border-2 transition-all",
                isActive 
                  ? "bg-blue-500/20 border-blue-500/50 -translate-y-2 shadow-[0_4px_0_0_rgba(59,130,246,0.5)]" 
                  : "border-transparent"
              )}>
                <Icon className={clsx("w-6 h-6", isActive && "stroke-[3px]")} />
              </div>
              
              <span className="text-xs font-bold tracking-wide uppercase">
                {item.label}
              </span>
            </Link>
          );
        })}
      </div>
    </div>
  );
}

// =================== FILE: src/presentation/components/ui/gamified/Button3D.tsx ===================

'use client';

import { ButtonHTMLAttributes, ReactNode } from 'react';
import { clsx } from 'clsx';
import { Loader2 } from 'lucide-react';

interface Button3DProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'success' | 'danger' | 'outline';
  isLoading?: boolean;
  children: ReactNode;
}

export function Button3D({ 
  children, 
  variant = 'primary', 
  isLoading, 
  className,
  disabled,
  ...props 
}: Button3DProps) {
  
  // Mapeig de variants a les nostres classes globals
  const variantClasses = {
    primary: 'btn-primary',
    success: 'btn-success',
    danger: 'btn-danger',
    outline: 'btn-outline',
  };

  return (
    <button
      disabled={disabled || isLoading}
      className={clsx(
        variantClasses[variant], // Aplica la classe base del globals.css
        "flex items-center justify-center gap-2", // Centrat extra
        (disabled || isLoading) && "opacity-70 cursor-not-allowed transform-none active:translate-y-0 active:border-b-4", // Estat desactivat
        className
      )}
      {...props}
    >
      {isLoading && <Loader2 className="w-5 h-5 animate-spin" />}
      {children}
    </button>
  );
}

// =================== FILE: src/presentation/components/ui/gamified/LanguagerSwitcher.tsx ===================

'use client';

import { useLocale } from 'next-intl';
import { usePathname, useRouter } from 'next/navigation';
import { Globe } from 'lucide-react';
import { useState } from 'react';
import { clsx } from 'clsx';

const languages = [
  { code: 'ca', label: 'Catal√†', flag: 'üê±' }, // Emoji provisional
  { code: 'en', label: 'English', flag: 'üá¨üáß' },
  { code: 'es', label: 'Espa√±ol', flag: 'üá™üá∏' },
];

export function LanguageSwitcher() {
  const locale = useLocale();
  const pathname = usePathname();
  const router = useRouter();
  const [isOpen, setIsOpen] = useState(false);

  const changeLanguage = (newLocale: string) => {
    // Substitu√Øm el locale actual pel nou a la URL
    // Ex: /ca/login -> /en/login
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`);
    router.push(newPath);
    setIsOpen(false);
  };

  return (
    <div className="relative">
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-4 py-2 rounded-xl border-2 border-slate-700 bg-slate-800 hover:bg-slate-700 font-bold text-slate-400 transition-colors"
      >
        <Globe className="w-5 h-5" />
        <span className="uppercase">{locale}</span>
      </button>

      {/* Dropdown Gamificat */}
      {isOpen && (
        <div className="absolute top-14 right-0 bg-slate-800 border-2 border-slate-700 rounded-xl shadow-xl p-2 w-48 flex flex-col gap-2 z-50 animate-in fade-in zoom-in-95">
          {languages.map((lang) => (
            <button
              key={lang.code}
              onClick={() => changeLanguage(lang.code)}
              className={clsx(
                "flex items-center gap-3 p-3 rounded-lg font-bold transition-all border-b-4 active:border-b-0 active:translate-y-1",
                locale === lang.code 
                  ? "bg-blue-500/20 text-blue-400 border-blue-500/50" 
                  : "hover:bg-slate-700 text-slate-300 border-transparent hover:border-slate-600"
              )}
            >
              <span className="text-xl">{lang.flag}</span>
              {lang.label}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

// =================== FILE: src/presentation/hooks/game/useGameSession.ts ===================

// filepath: src/presentation/hooks/game/useGameSession.ts
import { useState, useEffect } from 'react';
import { Challenge } from '@/core/entities/challenge.entity';
import { submitSessionAction } from '@/presentation/actions/gamification/submit-session.action';
import { SessionResultDTO } from '@/application/dto/session-result.dto';

type GameStatus = 'PLAYING' | 'SUBMITTING' | 'SUCCESS' | 'ERROR';

export function useGameSession(challenges: Challenge[]) {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [status, setStatus] = useState<GameStatus>('PLAYING');
  
  // CORRECCI√ì: Usem el tipus estricte en lloc de 'any'
  const [result, setResult] = useState<SessionResultDTO | null>(null);
  const [error, setError] = useState<string | null>(null);

  const currentChallenge = challenges[currentIndex];
  // Validaci√≥ per evitar NaN si l'array √©s buit
  const progress = challenges.length > 0 ? ((currentIndex) / challenges.length) * 100 : 0;

  const handleNext = () => {
    if (currentIndex < challenges.length - 1) {
      setCurrentIndex(prev => prev + 1);
    } else {
      setStatus('SUBMITTING');
    }
  };

  const handleRetry = () => {
    setError(null);
    setStatus('SUBMITTING');
  };

  useEffect(() => {
    if (status === 'SUBMITTING') {
      let isMounted = true; // Evitem actualitzacions si el component es desmunta

      const submit = async () => {
        try {
          const challengeIds = challenges.map(c => c.id);
          const topicId = challenges[0]?.topicId;

          if (!topicId) throw new Error("Topic ID not found");

          const response = await submitSessionAction(challengeIds, topicId);

          if (!isMounted) return;

          if (response.success) {
            setResult(response.data); // Ara TypeScript sap que aix√≤ √©s SessionResultDTO
            setStatus('SUCCESS');
          } else {
            setError(response.error);
            setStatus('ERROR');
          }
        } catch (err) {
            if (isMounted) {
                console.error(err);
                setError('CONNECTION_ERROR'); // Usem una clau per traduir despr√©s
                setStatus('ERROR');
            }
        }
      };

      submit();

      return () => { isMounted = false; };
    }
  }, [status, challenges]);

  return {
    currentChallenge,
    currentIndex,
    totalChallenges: challenges.length,
    progress,
    status,
    result,
    error,
    handleNext,
    handleRetry
  };
}

// =================== FILE: src/presentation/utils/icon-mapper.tsx ===================

// filepath: src/presentation/utils/icon-mapper.tsx
import { 
  Code2, 
  Database, 
  Server, 
  Globe, 
  Cpu, 
  Terminal,
  ShieldCheck,
  Atom,
  Container,
  Layers,
  LucideIcon 
} from 'lucide-react';

// Mapa de claus (string BD) -> Components (Lucide)
const ICON_MAP: Record<string, LucideIcon> = {
  'code': Code2,
  'database': Database,
  'server': Server,
  'web': Globe,
  'algo': Cpu,
  'terminal': Terminal,
  
  // Nous temes
  'brand-react': Atom,
  'security': ShieldCheck,
  'docker': Container,
  'fullstack': Layers,
  
  // Fallback
  'default': Code2 
};

/**
 * Retorna directament el JSX de la icona.
 * Aix√≠ al component nom√©s has de fer: {getTopicIcon(nom, classes)}
 */
export const getTopicIcon = (iconName: string, className?: string) => {
  const IconComponent = ICON_MAP[iconName] || ICON_MAP['default'];
  return <IconComponent className={className} />;
};

// =================== FILE: src/proxy.ts ===================

// filepath: src/proxy.ts
import createMiddleware from 'next-intl/middleware';
import { routing } from './routing';
 
export default createMiddleware(routing);

export const config = {
  // MATCHER CORRECTE (REGEX):
  // Atrapa totes les peticions EXCEPTE:
  // - api (rutes d'API)
  // - _next/static (fitxers est√†tics de Next)
  // - _vercel (interns de Vercel)
  // - fitxers amb extensi√≥ (imatges .png, .jpg, favicon.ico, etc.)
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
};

// =================== FILE: src/routing.ts ===================

// filepath: src/routing.ts
import { defineRouting } from 'next-intl/routing';

// NOVA IMPLEMENTACI√ì v4
export const routing = defineRouting({
  // Una llista de tots els locales suportats
  locales: ['ca', 'es', 'en'],
  
  // Si no es troba cap locale, es fa servir aquest
  defaultLocale: 'ca',

  // Opcional: Prefixar sempre el locale o no (as-needed √©s net per al default)
  localePrefix: 'always' 
});

// Exportem tipus per a usar-los al codi
export type Locale = (typeof routing.locales)[number];

// =================== FILE: supabase/snippets/Untitled query 908.sql ===================

-- 1. TAULA TOPICS
CREATE TABLE IF NOT EXISTS public.topics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    slug TEXT UNIQUE NOT NULL,
    name_key TEXT NOT NULL,
    icon_name TEXT NOT NULL,
    color_theme TEXT NOT NULL,
    active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. TAULA CHALLENGES
CREATE TABLE IF NOT EXISTS public.challenges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    topic_id UUID REFERENCES public.topics(id) ON DELETE CASCADE,
    difficulty_tier INT DEFAULT 1,
    type TEXT NOT NULL,
    content JSONB NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3. TAULA PROFILES (La crea Supabase Auth normalment, per√≤ la simulem per local)
CREATE TABLE IF NOT EXISTS public.profiles (
    id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    email TEXT,
    total_xp INT DEFAULT 0,
    level INT DEFAULT 1,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 4. TAULA USER_PROGRESS
CREATE TABLE IF NOT EXISTS public.user_progress (
    user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
    challenge_id UUID REFERENCES public.challenges(id) ON DELETE CASCADE,
    topic_id UUID REFERENCES public.topics(id),
    xp_earned INT DEFAULT 10,
    completed_at TIMESTAMPTZ DEFAULT NOW(),
    PRIMARY KEY (user_id, challenge_id)
);

-- Activem RLS (Bones pr√†ctiques, encara que el test usi Service Key)
ALTER TABLE public.topics ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.challenges ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_progress ENABLE ROW LEVEL SECURITY;

-- Permisos b√†sics de lectura p√∫blica
CREATE POLICY "Public topics" ON public.topics FOR SELECT USING (true);
CREATE POLICY "Public challenges" ON public.challenges FOR SELECT USING (true);

// =================== FILE: tsconfig.json ===================

{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
   "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}


// =================== FILE: vitest.config.ts ===================

// filepath: vitest.config.ts
import { defineConfig } from 'vitest/config';
import tsconfigPaths from 'vite-tsconfig-paths';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    tsconfigPaths(), // <--- AQUESTA √©s la clau m√†gica que soluciona el teu error
    react(),
  ],
  test: {
    environment: 'jsdom', // Necessari per testejar components de React m√©s endavant
    globals: true,
    setupFiles: [], // Aqu√≠ posarem setups globals si cal
  },
});